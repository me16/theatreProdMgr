<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CUE — Stage Management</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@400;500;700&family=Instrument+Serif&family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    /* ===== RESET & BASE ===== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
      color: #e0e0e0;
      line-height: 1.5;
    }
    button { cursor: pointer; font-family: inherit; }
    input, select, textarea { font-family: inherit; }
    a { color: inherit; text-decoration: none; }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #666; }

    /* ===== TOAST ===== */
    #toast-container {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      z-index: 9999; display: flex; flex-direction: column; align-items: center; gap: 8px;
      pointer-events: none;
    }
    .toast {
      padding: 10px 24px; border-radius: 8px; font-size: 14px; font-weight: 500;
      color: #fff; opacity: 0; transform: translateY(12px);
      animation: toastIn 0.3s forwards, toastOut 0.3s 2.2s forwards;
      pointer-events: auto; white-space: nowrap;
    }
    .toast--info { background: #2a2a3e; border: 1px solid #3a3a4e; }
    .toast--error { background: #6b1520; border: 1px solid #e63946; }
    .toast--success { background: #1a4a2a; border: 1px solid #2d8a4e; }
    @keyframes toastIn { to { opacity: 1; transform: translateY(0); } }
    @keyframes toastOut { to { opacity: 0; transform: translateY(-8px); } }

    /* ===== LOGIN OVERLAY ===== */
    #login-overlay {
      position: fixed; inset: 0; z-index: 2000;
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
      display: flex; align-items: center; justify-content: center;
    }
    .login-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 16px;
      padding: 48px 40px; width: 380px; max-width: 90vw; text-align: center;
      box-shadow: 0 24px 80px rgba(0,0,0,0.5);
    }
    .login-card h1 {
      font-family: 'Instrument Serif', serif; font-size: 56px;
      color: #d4af37; margin-bottom: 4px; letter-spacing: 4px;
    }
    .login-card .subtitle {
      font-family: 'Playfair Display', serif; font-size: 14px;
      color: #888; margin-bottom: 32px; letter-spacing: 1px;
    }
    .login-card input {
      width: 100%; padding: 12px 16px; margin-bottom: 12px;
      background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 8px;
      color: #e0e0e0; font-size: 14px; outline: none; transition: border-color 0.2s;
    }
    .login-card input:focus { border-color: #d4af37; }
    .login-card input::placeholder { color: #555; }
    .login-btn {
      width: 100%; padding: 12px; margin-top: 8px;
      background: #d4af37; color: #0f0f1e; border: none; border-radius: 8px;
      font-size: 15px; font-weight: 600; letter-spacing: 0.5px;
      transition: background 0.2s;
    }
    .login-btn:hover { background: #e0c04a; }
    .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .login-error {
      color: #e63946; font-size: 13px; margin-top: 12px; min-height: 20px;
    }

    /* ===== DASHBOARD ===== */
    #dashboard-view {
      position: fixed; inset: 0; z-index: 100;
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
      overflow-y: auto; display: none;
    }
    .dash-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 24px; border-bottom: 1px solid #2a2a3e;
      background: rgba(15,15,30,0.85); backdrop-filter: blur(8px);
      position: sticky; top: 0; z-index: 10;
    }
    .dash-header .logo {
      font-family: 'Instrument Serif', serif; font-size: 28px;
      color: #d4af37; letter-spacing: 3px;
    }
    .dash-header-right { display: flex; align-items: center; gap: 12px; }
    .dash-header .user-email { font-size: 13px; color: #888; }
    .dash-logout-btn {
      padding: 6px 16px; background: transparent; border: 1px solid #2a2a3e;
      color: #aaa; border-radius: 6px; font-size: 13px; transition: all 0.2s;
    }
    .dash-logout-btn:hover { border-color: #e63946; color: #e63946; }
    .dash-body { max-width: 960px; margin: 0 auto; padding: 32px 24px; }
    .dash-section-title {
      font-family: 'Playfair Display', serif; font-size: 22px; color: #d4af37;
      margin-bottom: 20px;
    }
    .dash-actions { display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap; }
    .dash-action-btn {
      padding: 10px 20px; background: #1a1a2e; border: 1px dashed #d4af37;
      color: #d4af37; border-radius: 8px; font-size: 14px; transition: all 0.2s;
    }
    .dash-action-btn:hover { background: #2a2a3e; }
    .productions-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .production-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 20px; transition: border-color 0.2s;
    }
    .production-card:hover { border-color: #d4af37; }
    .production-card h3 {
      font-family: 'Playfair Display', serif; font-size: 18px; color: #e0e0e0;
      margin-bottom: 8px;
    }
    .role-badge {
      display: inline-block; padding: 2px 10px; border-radius: 12px;
      font-size: 11px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;
    }
    .role-badge--owner { background: #d4af37; color: #0f0f1e; }
    .role-badge--member { background: #3a3a4e; color: #aaa; }
    .production-card .meta { font-size: 12px; color: #666; margin-top: 8px; }
    .production-card .open-btn {
      margin-top: 12px; padding: 8px 20px; background: #d4af37; color: #0f0f1e;
      border: none; border-radius: 6px; font-size: 13px; font-weight: 600;
      transition: background 0.2s;
    }
    .production-card .open-btn:hover { background: #e0c04a; }
    .empty-state { color: #555; font-size: 14px; text-align: center; padding: 40px 0; }

    /* ===== CREATE / JOIN MODALS ===== */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6);
      z-index: 300; display: flex; align-items: center; justify-content: center;
    }
    .modal-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 32px; width: 420px; max-width: 90vw;
    }
    .modal-card h2 {
      font-family: 'Playfair Display', serif; font-size: 20px; color: #d4af37;
      margin-bottom: 20px;
    }
    .modal-card label { display: block; font-size: 13px; color: #888; margin-bottom: 6px; }
    .modal-card input[type="text"],
    .modal-card input[type="file"] {
      width: 100%; padding: 10px 14px; margin-bottom: 16px;
      background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 6px;
      color: #e0e0e0; font-size: 14px; outline: none;
    }
    .modal-card input:focus { border-color: #d4af37; }
    .modal-btns { display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px; }
    .modal-btn-primary {
      padding: 8px 20px; background: #d4af37; color: #0f0f1e; border: none;
      border-radius: 6px; font-size: 13px; font-weight: 600;
    }
    .modal-btn-primary:hover { background: #e0c04a; }
    .modal-btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .modal-btn-cancel {
      padding: 8px 20px; background: transparent; border: 1px solid #2a2a3e;
      color: #aaa; border-radius: 6px; font-size: 13px;
    }
    .modal-btn-cancel:hover { border-color: #555; color: #e0e0e0; }
    .upload-progress {
      width: 100%; height: 4px; background: #2a2a3e; border-radius: 2px;
      margin-bottom: 12px; overflow: hidden; display: none;
    }
    .upload-progress-bar { height: 100%; background: #d4af37; width: 0%; transition: width 0.3s; }

    /* ===== MAIN APP SHELL ===== */
    #app-view { position: fixed; inset: 0; display: none; flex-direction: column; z-index: 50; }
    .app-header {
      display: flex; align-items: center; gap: 16px;
      padding: 10px 20px; border-bottom: 1px solid #2a2a3e;
      background: rgba(15,15,30,0.92); backdrop-filter: blur(8px);
      flex-shrink: 0; z-index: 60;
    }
    .app-header .logo {
      font-family: 'Instrument Serif', serif; font-size: 24px;
      color: #d4af37; letter-spacing: 2px; cursor: pointer;
      transition: opacity 0.2s;
    }
    .app-header .logo:hover { opacity: 0.8; }
    .app-header .prod-title {
      font-family: 'Playfair Display', serif; font-size: 16px; color: #ccc;
    }
    .app-header .spacer { flex: 1; }
    .app-header-btn {
      padding: 6px 14px; background: transparent; border: 1px solid #2a2a3e;
      color: #aaa; border-radius: 6px; font-size: 12px; transition: all 0.2s;
    }
    .app-header-btn:hover { border-color: #d4af37; color: #d4af37; }
    .app-header-btn--accent {
      border-color: #d4af37; color: #d4af37;
    }
    .app-header-btn--accent:hover { background: #d4af37; color: #0f0f1e; }
    .app-header .gear-btn {
      background: none; border: none; color: #888; font-size: 18px;
      transition: color 0.2s; padding: 4px 8px;
    }
    .app-header .gear-btn:hover { color: #d4af37; }

    /* ===== PROPS TABS ===== */
    .props-tabs {
      display: flex; border-bottom: 1px solid #2a2a3e; background: #12122a;
      flex-shrink: 0;
    }
    .props-tab {
      padding: 10px 24px; background: none; border: none;
      color: #888; font-size: 13px; font-weight: 500;
      border-bottom: 2px solid transparent; transition: all 0.2s;
    }
    .props-tab:hover { color: #ccc; }
    .props-tab--active { color: #d4af37; border-bottom-color: #d4af37; }

    /* ===== PROPS MAIN CONTENT ===== */
    .props-content { flex: 1; overflow-y: auto; padding: 24px; }

    /* ===== PROP FORM ===== */
    .prop-form {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 24px; margin-bottom: 24px;
    }
    .prop-form h3 {
      font-family: 'Playfair Display', serif; font-size: 18px; color: #d4af37;
      margin-bottom: 16px;
    }
    .form-row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .form-row label { font-size: 13px; color: #888; min-width: 100px; }
    .form-input {
      padding: 8px 12px; background: #0f0f1e; border: 1px solid #2a2a3e;
      border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none;
      transition: border-color 0.2s;
    }
    .form-input:focus { border-color: #d4af37; }
    .form-select {
      padding: 8px 12px; background: #0f0f1e; border: 1px solid #2a2a3e;
      border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none;
      appearance: none; cursor: pointer;
    }
    .cue-rows { margin: 16px 0; }
    .cue-row {
      display: flex; gap: 8px; align-items: center; margin-bottom: 8px;
      padding: 10px; background: #12122a; border-radius: 8px; flex-wrap: wrap;
    }
    .cue-row .cue-num {
      font-family: 'DM Mono', monospace; color: #d4af37; font-size: 12px;
      min-width: 32px; text-align: center;
    }
    .cue-row .arrow { color: #555; font-size: 14px; }
    .cue-row input { width: 70px; }
    .cue-row select { width: auto; }
    .cue-row .carrier-input { width: 110px; }
    .cue-row .remove-cue-btn {
      background: none; border: none; color: #e63946; font-size: 16px;
      padding: 4px 8px; transition: opacity 0.2s;
    }
    .cue-row .remove-cue-btn:hover { opacity: 0.7; }
    .add-cue-btn {
      padding: 8px 16px; background: transparent; border: 1px dashed #2a2a3e;
      color: #888; border-radius: 6px; font-size: 13px; transition: all 0.2s;
      width: 100%;
    }
    .add-cue-btn:hover { border-color: #d4af37; color: #d4af37; }
    .form-actions { display: flex; gap: 10px; margin-top: 16px; }

    /* ===== PROPS TABLE ===== */
    .props-table-wrap { overflow-x: auto; }
    .props-table {
      width: 100%; border-collapse: collapse; font-size: 14px;
    }
    .props-table th {
      text-align: left; padding: 10px 12px; color: #888; font-size: 12px;
      font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
      border-bottom: 1px solid #2a2a3e;
    }
    .props-table td { padding: 10px 12px; border-bottom: 1px solid #1a1a3e; }
    .props-table tr:hover td { background: rgba(212,175,55,0.03); }
    .cue-tag {
      display: inline-block; padding: 2px 8px; border-radius: 4px;
      font-size: 11px; font-family: 'DM Mono', monospace; margin: 2px;
    }
    .cue-tag--enter { background: #1a3a2a; color: #4caf50; }
    .cue-tag--exit { background: #3a1a1a; color: #e63946; }

    /* ===== STAGE VIEW ===== */
    .stage-nav {
      display: flex; align-items: center; gap: 16px; margin-bottom: 20px;
      padding: 12px 16px; background: #1a1a2e; border-radius: 8px;
    }
    .stage-nav .page-display {
      font-family: 'DM Mono', monospace; font-size: 16px; color: #d4af37;
      min-width: 80px; text-align: center;
    }
    .stage-nav button {
      padding: 6px 14px; background: #0f0f1e; border: 1px solid #2a2a3e;
      color: #ccc; border-radius: 6px; font-size: 13px; transition: all 0.2s;
    }
    .stage-nav button:hover { border-color: #d4af37; color: #d4af37; }
    .stage-columns {
      display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; min-height: 300px;
    }
    .stage-col {
      border-radius: 12px; padding: 16px; min-height: 200px;
    }
    .stage-col--sl { background: #2d5a3d; }
    .stage-col--on { background: #3a1525; }
    .stage-col--sr { background: #3d4a5c; }
    .stage-col h4 {
      font-family: 'Playfair Display', serif; font-size: 14px; color: rgba(255,255,255,0.7);
      margin-bottom: 12px; text-align: center; text-transform: uppercase; letter-spacing: 1px;
    }
    .stage-prop {
      background: rgba(0,0,0,0.25); border-radius: 8px; padding: 10px 12px;
      margin-bottom: 8px; cursor: pointer; transition: all 0.2s;
      border: 1px solid transparent;
    }
    .stage-prop:hover { border-color: rgba(255,255,255,0.15); }
    .stage-prop--warn { border-color: #d4af37; box-shadow: 0 0 12px rgba(212,175,55,0.15); }
    .stage-prop .prop-name { font-weight: 600; font-size: 14px; }
    .stage-prop .prop-carrier {
      font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 2px;
    }

    /* ===== PROP NOTES MODAL ===== */
    .prop-notes-modal {
      position: fixed; inset: 0; z-index: 400;
      background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center;
    }
    .prop-notes-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 24px; width: 520px; max-width: 90vw; max-height: 80vh; overflow-y: auto;
    }
    .prop-notes-card h3 {
      font-family: 'Playfair Display', serif; font-size: 18px; color: #d4af37;
      margin-bottom: 12px;
    }
    .prop-notes-card .cue-summary { font-size: 13px; color: #888; margin-bottom: 16px; }
    .prop-notes-card textarea {
      width: 100%; min-height: 120px; padding: 12px;
      background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 8px;
      color: #e0e0e0; font-size: 14px; resize: vertical; outline: none;
    }
    .prop-notes-card textarea:focus { border-color: #d4af37; }
    .prop-notes-card textarea:disabled { opacity: 0.6; cursor: not-allowed; }

    /* ===== PRE/POST CHECK ===== */
    .check-section { margin-bottom: 32px; }
    .check-section h3 {
      font-family: 'Playfair Display', serif; font-size: 18px; color: #d4af37;
      margin-bottom: 4px;
    }
    .check-progress {
      font-size: 12px; color: #888; margin-bottom: 12px;
    }
    .check-progress .badge {
      display: inline-block; padding: 2px 8px; border-radius: 10px;
      font-weight: 600; margin-left: 8px;
    }
    .check-progress .badge--done { background: #1a4a2a; color: #4caf50; }
    .check-progress .badge--pending { background: #3a3a1a; color: #d4af37; }
    .check-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;
    }
    .check-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 8px;
      padding: 12px; cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .check-card:hover { border-color: #555; }
    .check-card--checked { border-color: #2d8a4e; background: #1a2a20; }
    .check-card .check-name { font-weight: 600; font-size: 14px; }
    .check-card .check-detail { font-size: 12px; color: #888; margin-top: 2px; }
    .check-card .check-mark { float: right; font-size: 18px; }
    .reset-checks-btn {
      margin-top: 12px; padding: 6px 16px; background: transparent;
      border: 1px solid #2a2a3e; color: #888; border-radius: 6px; font-size: 12px;
    }
    .reset-checks-btn:hover { border-color: #e63946; color: #e63946; }

    /* ===== SHOW TIMER ===== */
    .timer-panel {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 20px; margin-bottom: 20px;
    }
    .timer-panel h3 {
      font-family: 'Playfair Display', serif; font-size: 16px; color: #d4af37;
      margin-bottom: 12px;
    }
    .timer-inputs { display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap; }
    .timer-inputs label { font-size: 12px; color: #888; }
    .timer-inputs input {
      width: 80px; padding: 6px 10px; background: #0f0f1e;
      border: 1px solid #2a2a3e; border-radius: 6px; color: #e0e0e0;
      font-size: 14px; outline: none;
    }
    .timer-inputs input:focus { border-color: #d4af37; }
    .timer-btns { display: flex; gap: 8px; margin-bottom: 12px; }
    .timer-btn {
      padding: 6px 16px; border-radius: 6px; font-size: 13px; border: none;
      font-weight: 600; transition: opacity 0.2s;
    }
    .timer-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .timer-btn--start { background: #2d8a4e; color: #fff; }
    .timer-btn--hold { background: #d4af37; color: #0f0f1e; }
    .timer-btn--stop { background: #e63946; color: #fff; }
    .timer-progress { width: 100%; height: 6px; background: #2a2a3e; border-radius: 3px; margin-bottom: 8px; }
    .timer-progress-bar { height: 100%; background: #d4af37; border-radius: 3px; width: 0%; transition: width 0.5s; }
    .timer-display {
      display: flex; gap: 16px; font-size: 13px; color: #888;
      font-family: 'DM Mono', monospace;
    }

    /* ===== PRODUCTION SETTINGS PANEL ===== */
    #production-panel {
      position: fixed; top: 0; right: -480px; bottom: 0; width: 460px; max-width: 100vw;
      background: #1a1a2e; border-left: 1px solid #2a2a3e; z-index: 250;
      overflow-y: auto; transition: right 0.3s ease; padding: 24px;
    }
    #production-panel.open { right: 0; }
    #production-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.4);
      z-index: 240; display: none;
    }
    #production-backdrop.open { display: block; }
    .panel-header {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;
    }
    .panel-header h2 {
      font-family: 'Playfair Display', serif; font-size: 20px; color: #d4af37;
    }
    .panel-close {
      background: none; border: none; color: #888; font-size: 20px; padding: 4px 8px;
    }
    .panel-close:hover { color: #e0e0e0; }
    .panel-section { margin-bottom: 24px; }
    .panel-section h4 {
      font-size: 13px; color: #888; text-transform: uppercase; letter-spacing: 0.5px;
      margin-bottom: 10px; border-bottom: 1px solid #2a2a3e; padding-bottom: 6px;
    }
    .panel-section input[type="text"] {
      width: 100%; padding: 8px 12px; background: #0f0f1e; border: 1px solid #2a2a3e;
      border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none;
    }
    .panel-section input:focus { border-color: #d4af37; }
    .join-code-display {
      font-family: 'DM Mono', monospace; font-size: 20px; color: #d4af37;
      letter-spacing: 3px; margin-bottom: 8px;
    }
    .join-code-inactive { color: #555; text-decoration: line-through; }
    .panel-btn {
      padding: 6px 14px; background: #0f0f1e; border: 1px solid #2a2a3e;
      color: #ccc; border-radius: 6px; font-size: 12px; transition: all 0.2s;
    }
    .panel-btn:hover { border-color: #d4af37; color: #d4af37; }
    .panel-btn--danger:hover { border-color: #e63946; color: #e63946; }
    .member-list { list-style: none; }
    .member-item {
      display: flex; align-items: center; gap: 10px; padding: 8px 0;
      border-bottom: 1px solid #1a1a3e; font-size: 13px;
    }
    .member-item .member-email { flex: 1; color: #ccc; }
    .member-item .member-actions { display: flex; gap: 6px; }
    .member-item .member-actions button {
      padding: 3px 10px; background: none; border: 1px solid #2a2a3e;
      color: #888; border-radius: 4px; font-size: 11px; cursor: pointer;
    }
    .member-item .member-actions button:hover { border-color: #d4af37; color: #d4af37; }
    .member-item .member-actions .remove-btn:hover { border-color: #e63946; color: #e63946; }

    /* ===== LINE NOTES OVERLAY ===== */
    #linenotes-overlay {
      position: fixed; inset: 0; z-index: 500;
      background: #0f0e0c; display: none; flex-direction: column;
    }
    #linenotes-overlay.open { display: flex; }

    /* Line Notes Header */
    .ln-header {
      display: flex; align-items: center; gap: 12px;
      padding: 8px 16px; border-bottom: 1px solid #2e2c29;
      background: #1a1916; flex-shrink: 0;
    }
    .ln-header .back-btn {
      background: none; border: 1px solid #2e2c29; color: #9a9488;
      padding: 4px 12px; border-radius: 6px; font-size: 12px; transition: all 0.2s;
    }
    .ln-header .back-btn:hover { border-color: #c8a96e; color: #c8a96e; }
    .ln-header .ln-logo {
      font-family: 'Instrument Serif', serif; font-size: 20px; color: #c8a96e;
      letter-spacing: 2px;
    }
    .ln-header .show-name {
      font-family: 'DM Sans', sans-serif; font-size: 13px; color: #9a9488;
    }
    .ln-header .ln-spacer { flex: 1; }
    .ln-header-btn {
      padding: 5px 12px; background: transparent; border: 1px solid #2e2c29;
      color: #9a9488; border-radius: 5px; font-size: 12px; font-family: 'DM Sans', sans-serif;
      transition: all 0.2s;
    }
    .ln-header-btn:hover { border-color: #c8a96e; color: #c8a96e; }
    .ln-header-btn--active { border-color: #c8a96e; color: #c8a96e; background: rgba(200,169,110,0.1); }
    .ln-page-nav {
      display: flex; align-items: center; gap: 8px;
    }
    .ln-page-nav .page-num {
      font-family: 'DM Mono', monospace; font-size: 13px; color: #c8a96e; min-width: 60px; text-align: center;
    }
    .ln-page-nav button {
      background: none; border: 1px solid #2e2c29; color: #9a9488;
      padding: 4px 10px; border-radius: 4px; font-size: 13px;
    }
    .ln-page-nav button:hover { border-color: #c8a96e; color: #c8a96e; }

    /* Line Notes Body */
    .ln-body { display: flex; flex: 1; overflow: hidden; }

    /* Line Notes Sidebar */
    .ln-sidebar {
      width: 280px; min-width: 280px; border-right: 1px solid #2e2c29;
      background: #1a1916; display: flex; flex-direction: column;
      overflow-y: auto;
    }
    .ln-sidebar-section { padding: 12px; border-bottom: 1px solid #2e2c29; }
    .ln-sidebar-section h5 {
      font-family: 'DM Sans', sans-serif; font-size: 11px; color: #5c5850;
      text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;
    }
    .char-item {
      display: flex; align-items: center; gap: 8px; padding: 5px 8px;
      border-radius: 5px; cursor: pointer; font-size: 13px; color: #e8e4dc;
      transition: background 0.15s;
    }
    .char-item:hover { background: #232220; }
    .char-item--active { background: #232220; }
    .char-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .char-item .char-count { margin-left: auto; font-size: 11px; color: #5c5850; font-family: 'DM Mono', monospace; }
    .char-item .delete-char {
      margin-left: 4px; background: none; border: none; color: #5c5850;
      font-size: 14px; cursor: pointer; padding: 0 4px; opacity: 0; transition: opacity 0.15s;
    }
    .char-item:hover .delete-char { opacity: 1; }
    .char-item .delete-char:hover { color: #e63946; }
    .add-char-btn {
      padding: 4px 10px; background: none; border: 1px dashed #2e2c29;
      color: #5c5850; border-radius: 4px; font-size: 12px; width: 100%;
      margin-top: 6px; transition: all 0.2s;
    }
    .add-char-btn:hover { border-color: #c8a96e; color: #c8a96e; }

    /* Note types */
    .note-types { display: flex; gap: 4px; flex-wrap: wrap; }
    .note-type-btn {
      padding: 4px 10px; background: #232220; border: 1px solid #2e2c29;
      color: #9a9488; border-radius: 4px; font-size: 11px; font-family: 'DM Mono', monospace;
      transition: all 0.15s;
    }
    .note-type-btn:hover { border-color: #c8a96e; }
    .note-type-btn--active { border-color: #c8a96e; color: #c8a96e; background: rgba(200,169,110,0.08); }

    /* Notes list */
    .notes-list { flex: 1; overflow-y: auto; }
    .note-item {
      display: flex; gap: 8px; padding: 8px 12px; border-bottom: 1px solid #232220;
      cursor: pointer; transition: background 0.15s; font-size: 12px;
    }
    .note-item:hover { background: #232220; }
    .note-color-bar { width: 3px; border-radius: 2px; flex-shrink: 0; }
    .note-item-content { flex: 1; min-width: 0; }
    .note-item-header { display: flex; gap: 6px; align-items: center; margin-bottom: 2px; }
    .note-page {
      font-family: 'DM Mono', monospace; color: #5c5850; font-size: 10px;
    }
    .note-char-name { color: #c8a96e; font-size: 11px; font-weight: 500; }
    .note-type-label {
      font-family: 'DM Mono', monospace; font-size: 10px; padding: 1px 5px;
      background: #232220; border-radius: 3px; color: #9a9488;
    }
    .note-text-preview {
      color: #5c5850; font-style: italic; font-size: 11px;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
    .note-delete-btn {
      background: none; border: none; color: #5c5850; font-size: 14px;
      cursor: pointer; padding: 0 4px; opacity: 0; transition: opacity 0.15s;
      align-self: center;
    }
    .note-item:hover .note-delete-btn { opacity: 1; }
    .note-delete-btn:hover { color: #e63946; }

    /* Line Notes canvas area */
    .ln-canvas-area {
      flex: 1; overflow: auto; display: flex; justify-content: center;
      padding: 20px; background: #0f0e0c; position: relative;
    }
    .ln-canvas-container {
      position: relative; display: inline-block; box-shadow: 0 4px 32px rgba(0,0,0,0.5);
    }
    .ln-canvas-container canvas { display: block; }
    .zones-layer {
      position: absolute; inset: 0; pointer-events: none;
    }
    .line-zone {
      position: absolute; border-radius: 2px; cursor: pointer;
      pointer-events: all; transition: background 0.15s;
    }
    .line-zone:hover { background: rgba(200,169,110,0.15); }
    .line-zone--char { background: rgba(91,155,212,0.08); }
    .line-zone--stage-dir { background: rgba(128,128,128,0.06); }
    .line-zone--has-note { border-bottom: 2px solid; }
    .note-type-tag {
      position: absolute; right: -34px; top: 50%; transform: translateY(-50%);
      font-family: 'DM Mono', monospace; font-size: 9px; padding: 1px 4px;
      border-radius: 3px; color: #fff; white-space: nowrap;
    }

    /* Zone editor styles */
    .zone-editor-panel {
      width: 300px; min-width: 300px; border-left: 1px solid #2e2c29;
      background: #1a1916; overflow-y: auto; padding: 12px;
      display: none;
    }
    .zone-editor-panel.open { display: block; }
    .zone-editor-panel h5 {
      font-size: 11px; color: #5c5850; text-transform: uppercase;
      letter-spacing: 1px; margin-bottom: 8px;
    }
    .zone-toolbar {
      display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 12px;
    }
    .zone-toolbar button {
      padding: 4px 10px; background: #232220; border: 1px solid #2e2c29;
      color: #9a9488; border-radius: 4px; font-size: 11px; transition: all 0.15s;
    }
    .zone-toolbar button:hover { border-color: #c8a96e; color: #c8a96e; }
    .zone-detail { margin-bottom: 12px; }
    .zone-detail label { display: block; font-size: 11px; color: #5c5850; margin-bottom: 3px; }
    .zone-detail input, .zone-detail textarea {
      width: 100%; padding: 6px 8px; background: #232220; border: 1px solid #2e2c29;
      border-radius: 4px; color: #e8e4dc; font-size: 12px; outline: none;
    }
    .zone-detail input:focus, .zone-detail textarea:focus { border-color: #c8a96e; }
    .zone-detail textarea { min-height: 60px; resize: vertical; font-family: 'DM Sans', sans-serif; }
    .zone-list-item {
      display: flex; gap: 6px; align-items: center; padding: 5px 8px;
      border-radius: 4px; cursor: pointer; font-size: 11px; color: #9a9488;
      transition: background 0.15s;
    }
    .zone-list-item:hover { background: #232220; }
    .zone-list-item--selected { background: #232220; border: 1px solid #c8a96e; }
    .zone-list-item .zone-type-label {
      font-family: 'DM Mono', monospace; font-size: 9px; padding: 1px 5px;
      background: #2e2c29; border-radius: 3px;
    }
    .zone-list-item .zone-text { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .zone-list-item .zone-delete {
      background: none; border: none; color: #5c5850; cursor: pointer; font-size: 12px;
      opacity: 0; transition: opacity 0.15s;
    }
    .zone-list-item:hover .zone-delete { opacity: 1; }
    .zone-list-item .zone-delete:hover { color: #e63946; }
    .zone-saved-badge {
      display: inline-block; padding: 2px 8px; background: #1a4a2a;
      color: #4caf50; border-radius: 4px; font-size: 11px; margin-left: 8px;
      opacity: 0; transition: opacity 0.3s;
    }
    .zone-saved-badge.visible { opacity: 1; }
    .multi-select-bar {
      padding: 8px; background: rgba(200,169,110,0.1); border: 1px solid #c8a96e;
      border-radius: 6px; margin-bottom: 8px; display: none;
    }
    .multi-select-bar.open { display: block; }
    .multi-select-bar span { font-size: 12px; color: #c8a96e; }
    .multi-select-bar button {
      padding: 3px 8px; background: none; border: 1px solid #2e2c29;
      color: #9a9488; border-radius: 3px; font-size: 11px; margin-left: 4px;
    }
    .multi-select-bar button:hover { border-color: #c8a96e; color: #c8a96e; }

    /* Popover */
    .note-popover {
      position: fixed; z-index: 600; background: #1a1916; border: 1px solid #2e2c29;
      border-radius: 10px; padding: 14px; width: 300px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5); display: none;
    }
    .note-popover.open { display: block; }
    .popover-chars {
      display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px;
    }
    .popover-char {
      display: flex; align-items: center; gap: 4px; padding: 4px 10px;
      background: #232220; border: 1px solid #2e2c29; border-radius: 5px;
      font-size: 12px; color: #e8e4dc; cursor: pointer; transition: all 0.15s;
    }
    .popover-char:hover { border-color: #c8a96e; }
    .popover-char--active { border-color: #c8a96e; background: rgba(200,169,110,0.1); }
    .popover-char .shortcut-key {
      font-family: 'DM Mono', monospace; font-size: 10px; color: #5c5850;
    }
    .popover-types {
      display: flex; gap: 4px; margin-bottom: 10px;
    }
    .popover-type {
      padding: 4px 10px; background: #232220; border: 1px solid #2e2c29;
      border-radius: 4px; font-family: 'DM Mono', monospace; font-size: 11px;
      color: #9a9488; cursor: pointer; transition: all 0.15s;
    }
    .popover-type:hover { border-color: #c8a96e; }
    .popover-type--active { border-color: #c8a96e; color: #c8a96e; }
    .popover-line-text {
      font-style: italic; font-size: 12px; color: #5c5850;
      margin-bottom: 10px; max-height: 60px; overflow-y: auto;
      padding: 6px; background: #232220; border-radius: 4px;
    }
    .popover-btns { display: flex; gap: 8px; justify-content: flex-end; }
    .popover-btn {
      padding: 5px 14px; border-radius: 5px; font-size: 12px; border: none; font-weight: 500;
    }
    .popover-btn--confirm { background: #c8a96e; color: #0f0e0c; }
    .popover-btn--confirm:hover { background: #d4b97e; }
    .popover-btn--cancel { background: #232220; color: #9a9488; border: 1px solid #2e2c29; }
    .popover-btn--cancel:hover { background: #2e2c29; }
    .popover-btn--delete { background: #6b1520; color: #fff; }
    .popover-btn--delete:hover { background: #8a1a28; }

    /* Processing overlay */
    .processing-overlay {
      position: absolute; inset: 0; background: rgba(15,14,12,0.9);
      display: none; flex-direction: column; align-items: center; justify-content: center;
      z-index: 550;
    }
    .processing-overlay.open { display: flex; }
    .processing-overlay .text {
      font-family: 'Instrument Serif', serif; font-size: 18px; color: #c8a96e;
      margin-bottom: 16px;
    }
    .processing-bar { width: 240px; height: 4px; background: #2e2c29; border-radius: 2px; overflow: hidden; }
    .processing-bar-fill { height: 100%; background: #c8a96e; width: 0%; transition: width 0.4s; }

    /* Send notes modal */
    .send-notes-modal {
      position: fixed; inset: 0; z-index: 650; background: rgba(0,0,0,0.6);
      display: none; align-items: center; justify-content: center;
    }
    .send-notes-modal.open { display: flex; }
    .send-notes-card {
      background: #1a1916; border: 1px solid #2e2c29; border-radius: 12px;
      padding: 24px; width: 560px; max-width: 90vw; max-height: 80vh; overflow-y: auto;
    }
    .send-notes-card h3 {
      font-family: 'Instrument Serif', serif; font-size: 20px; color: #c8a96e;
      margin-bottom: 16px;
    }
    .send-char-section { margin-bottom: 16px; }
    .send-char-header {
      display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
    }
    .send-char-header .char-name { font-weight: 600; color: #e8e4dc; font-size: 14px; }
    .send-char-header .mail-link {
      font-size: 12px; color: #c8a96e; cursor: pointer;
      text-decoration: underline;
    }
    .send-note-row {
      font-size: 12px; color: #9a9488; padding: 4px 0 4px 16px;
      border-left: 2px solid #2e2c29;
    }
    .send-notes-actions { display: flex; gap: 10px; margin-top: 16px; }

    /* Character modal */
    .char-modal {
      position: fixed; inset: 0; z-index: 620; background: rgba(0,0,0,0.5);
      display: none; align-items: center; justify-content: center;
    }
    .char-modal.open { display: flex; }
    .char-modal-card {
      background: #1a1916; border: 1px solid #2e2c29; border-radius: 10px;
      padding: 24px; width: 340px;
    }
    .char-modal-card h3 {
      font-family: 'Instrument Serif', serif; font-size: 18px; color: #c8a96e;
      margin-bottom: 16px;
    }
    .char-modal-card input[type="text"] {
      width: 100%; padding: 8px 12px; background: #232220; border: 1px solid #2e2c29;
      border-radius: 6px; color: #e8e4dc; font-size: 14px; outline: none; margin-bottom: 12px;
    }
    .char-modal-card input:focus { border-color: #c8a96e; }
    .char-color-grid {
      display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px;
    }
    .char-color-swatch {
      width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
      border: 2px solid transparent; transition: border-color 0.15s;
    }
    .char-color-swatch:hover { border-color: rgba(255,255,255,0.3); }
    .char-color-swatch--selected { border-color: #fff; }

    /* ===== UTILITY ===== */
    .hidden { display: none !important; }
    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); border: 0;
    }
  </style>
</head>
<body>
  <!-- Toast container -->
  <div id="toast-container"></div>

  <!-- Login overlay -->
  <div id="login-overlay">
    <div class="login-card">
      <h1>CUE</h1>
      <p class="subtitle">Stage Management Platform</p>
      <input type="email" id="login-email" placeholder="Email" autocomplete="email" />
      <input type="password" id="login-password" placeholder="Password" autocomplete="current-password" />
      <button class="login-btn" id="login-btn">Sign In</button>
      <p class="login-error" id="login-error"></p>
    </div>
  </div>

  <!-- Dashboard view -->
  <div id="dashboard-view">
    <div class="dash-header">
      <span class="logo">CUE</span>
      <div class="dash-header-right">
        <span class="user-email" id="dash-user-email"></span>
        <button class="dash-logout-btn" id="dash-logout-btn">Sign Out</button>
      </div>
    </div>
    <div class="dash-body">
      <h2 class="dash-section-title">Your Productions</h2>
      <div class="dash-actions">
        <button class="dash-action-btn" id="create-production-btn">+ Create Production</button>
        <button class="dash-action-btn" id="join-production-btn">Join with Code</button>
      </div>
      <div class="productions-grid" id="productions-grid"></div>
    </div>
  </div>

  <!-- Main app view -->
  <div id="app-view">
    <div class="app-header">
      <span class="logo" id="app-back-logo">CUE</span>
      <span class="prod-title" id="app-prod-title"></span>
      <span class="role-badge" id="app-role-badge"></span>
      <div class="spacer"></div>
      <button class="app-header-btn app-header-btn--accent" id="open-linenotes-btn">Line Notes</button>
      <button class="app-header-btn gear-btn hidden" id="open-settings-btn" title="Production Settings">⚙</button>
      <button class="app-header-btn" id="app-logout-btn">Sign Out</button>
    </div>
    <div class="props-tabs" id="props-tabs">
      <button class="props-tab props-tab--active" data-tab="manage">Manage Props</button>
      <button class="props-tab" data-tab="view">View Show</button>
      <button class="props-tab" data-tab="check">Pre/Post Check</button>
    </div>
    <div class="props-content" id="props-content"></div>
  </div>

  <!-- Production settings panel -->
  <div id="production-backdrop"></div>
  <div id="production-panel"></div>

  <!-- Line Notes overlay -->
  <div id="linenotes-overlay">
    <div class="ln-header">
      <button class="back-btn" id="ln-back-btn">← Back</button>
      <span class="ln-logo">CUE</span>
      <span class="show-name" id="ln-show-name"></span>
      <div class="ln-spacer"></div>
      <div class="ln-page-nav">
        <button id="ln-prev-page">◄</button>
        <span class="page-num" id="ln-page-num">1 / 1</span>
        <button id="ln-next-page">►</button>
      </div>
      <button class="ln-header-btn" id="ln-split-btn">2-up</button>
      <button class="ln-header-btn" id="ln-view-notes-btn">Notes</button>
      <button class="ln-header-btn hidden" id="ln-view-zones-btn">Zones</button>
      <button class="ln-header-btn" id="ln-send-btn">Send Notes</button>
    </div>
    <div class="ln-body">
      <div class="ln-sidebar" id="ln-sidebar">
        <div class="ln-sidebar-section">
          <h5>Cast</h5>
          <div id="ln-cast-list"></div>
          <button class="add-char-btn" id="ln-add-char-btn">+ Add Character</button>
        </div>
        <div class="ln-sidebar-section">
          <h5>Note Type</h5>
          <div class="note-types" id="ln-note-types"></div>
        </div>
        <div class="ln-sidebar-section" style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
          <h5>Notes</h5>
          <div class="notes-list" id="ln-notes-list"></div>
        </div>
      </div>
      <div class="ln-canvas-area" id="ln-canvas-area">
        <div class="ln-canvas-container" id="ln-canvas-container">
          <canvas id="ln-canvas"></canvas>
          <div class="zones-layer" id="ln-zones-layer"></div>
        </div>
        <div class="processing-overlay" id="ln-processing">
          <span class="text">Loading script…</span>
          <div class="processing-bar"><div class="processing-bar-fill" id="ln-progress-fill"></div></div>
        </div>
      </div>
      <div class="zone-editor-panel" id="zone-editor-panel"></div>
    </div>
  </div>

  <!-- Note popover -->
  <div class="note-popover" id="note-popover"></div>

  <!-- Character modal -->
  <div class="char-modal" id="char-modal"></div>

  <!-- Send notes modal -->
  <div class="send-notes-modal" id="send-notes-modal"></div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
