<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CUE — Stage Management</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Instrument+Serif&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
  :root {
    --gold: #C8A050; --gold-light: #DCBE6A; --gold-muted: #C8A05033; --gold-glow: rgba(200,160,80,0.15);
    --bg-deep: #0B0B14; --bg-base: #111120; --bg-card: #171728;
    --bg-raised: #1E1E32; --bg-border: #2A2A42; --bg-hover: #1e1e34;
    --text-primary: #E8E8F0; --text-secondary: #9898B0; --text-muted: #5C5C72;
    --red: #E04050; --green: #38A060; --blue: #5b9bd4;
    /* --ln-* parchment variables REMOVED — unified palette only */
  }
  .app-topbar { display:flex; align-items:center; height:52px; background:var(--bg-base); border-bottom:1px solid var(--bg-border); padding:0 16px; flex-shrink:0; gap:12px; }
  .app-topbar-logo { font-family:"Instrument Serif",serif; font-size:22px; color:var(--gold); letter-spacing:3px; cursor:pointer; padding-right:16px; border-right:1px solid var(--bg-border); }
  .app-topbar-logo:hover { opacity:0.75; }
  .app-topbar-title { font-family:"Inter",sans-serif; font-size:15px; color:var(--text-secondary); max-width:260px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .app-tabbar { display:flex; background:var(--bg-base); border-bottom:1px solid var(--bg-border); padding:0 8px; flex-shrink:0; }
  .app-tab { height:42px; padding:0 22px; background:none; border:none; border-bottom:2px solid transparent; color:var(--text-muted); font-size:13px; font-weight:500; cursor:pointer; transition:all 0.2s; }
  .app-tab:hover { color:var(--text-secondary); }
  .app-tab--active { color:var(--gold); border-bottom-color:var(--gold); }
  .app-tab-content { flex:1; overflow:hidden; position:relative; display:flex; flex-direction:column; }
  .tab-panel { display:none; flex:1; overflow:hidden; flex-direction:column; }
  .tab-panel--active { display:flex; }
  .topbar-btn { background:none; border:1px solid var(--bg-border); color:var(--text-muted); font-size:12px; padding:5px 12px; border-radius:4px; cursor:pointer; transition:all 0.2s; }
  .topbar-btn:hover { border-color:var(--gold); color:var(--gold); }
  .cast-tab-content { flex:1; overflow-y:auto; padding:24px; }
  .cast-header-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .cast-add-btn { background:var(--gold); color:#0a0a14; border:none; padding:7px 16px; border-radius:5px; font-size:13px; font-weight:600; cursor:pointer; }
  .cast-add-btn:hover { background:var(--gold-light); }
  .cast-table { width:100%; border-collapse:collapse; font-size:13px; }
  .cast-table th { text-align:left; color:var(--text-muted); font-size:11px; text-transform:uppercase; letter-spacing:1px; padding:6px 10px; border-bottom:1px solid var(--bg-border); }
  .cast-table td { padding:10px; border-bottom:1px solid var(--bg-border); vertical-align:middle; }
  .cast-member-name { font-weight:600; color:var(--text-primary); }
  .cast-member-email { font-family:"DM Mono",monospace; font-size:11px; color:var(--text-muted); }
  .cast-characters { display:flex; flex-wrap:wrap; gap:4px; }
  .char-chip { display:inline-flex; align-items:center; gap:4px; background:var(--bg-raised); border:1px solid var(--bg-border); border-radius:20px; padding:2px 8px; font-size:11px; color:var(--text-secondary); }
  .char-chip-dot { width:7px; height:7px; border-radius:50%; flex-shrink:0; }
  .cast-actions { white-space:nowrap; }
  .cast-action-btn { background:none; border:1px solid var(--bg-border); color:var(--text-secondary); font-size:11px; padding:3px 10px; border-radius:4px; cursor:pointer; margin-right:4px; }
  .cast-action-btn:hover { border-color:var(--gold); color:var(--gold); }
  .cast-action-btn--danger:hover { border-color:var(--red); color:var(--red); }
  .cast-modal { position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:500; display:none; align-items:center; justify-content:center; }
  .cast-modal.open { display:flex; }
  .cast-modal-card { background:var(--bg-card); border:1px solid var(--bg-border); border-radius:10px; padding:28px; width:100%; max-width:500px; max-height:90vh; overflow-y:auto; }
  .cast-modal-field { margin-bottom:14px; }
  .cast-modal-field label { display:block; font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; margin-bottom:5px; }
  .char-chips-editor { display:flex; flex-wrap:wrap; gap:6px; min-height:28px; padding:4px 0; margin-bottom:6px; }
  .char-chip-editable { display:inline-flex; align-items:center; gap:4px; background:var(--bg-raised); border:1px solid var(--bg-border); border-radius:20px; padding:3px 8px; font-size:12px; color:var(--text-secondary); }
  .chip-remove { background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:14px; line-height:1; padding:0 2px; }
  .char-chip-add-row { display:flex; align-items:center; gap:6px; }
  .color-grid { display:flex; flex-wrap:wrap; gap:8px; }
  .color-swatch { width:26px; height:26px; border-radius:50%; cursor:pointer; border:2px solid transparent; }
  .color-swatch--selected { border-color:#fff; box-shadow:0 0 0 3px rgba(255,255,255,0.15); }
  .cast-picker { position:relative; }
  .cast-picker-input { width:100%; }
  .cast-picker-dropdown { position:absolute; top:100%; left:0; right:0; background:var(--bg-card); border:1px solid var(--bg-border); border-radius:6px; box-shadow:0 8px 24px rgba(0,0,0,0.4); max-height:200px; overflow-y:auto; display:none; z-index:100; margin-top:2px; }
  .cast-picker-dropdown.open { display:block; }
  .cast-picker-option { padding:8px 12px; cursor:pointer; font-size:13px; color:var(--text-secondary); }
  .cast-picker-option:hover { background:var(--bg-hover); color:var(--text-primary); }
  .opt-char { font-size:10px; color:var(--text-muted); font-family:"DM Mono",monospace; margin-top:2px; }
  .settings-content { flex:1; overflow-y:auto; padding:28px; max-width:680px; }
  .settings-section { background:var(--bg-card); border:1px solid var(--bg-border); border-radius:8px; padding:20px; margin-bottom:16px; }
  .settings-section h3 { font-size:11px; text-transform:uppercase; letter-spacing:2px; color:var(--text-muted); margin-bottom:14px; padding-bottom:10px; border-bottom:1px solid var(--bg-border); }
  .settings-field { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .settings-field input, .settings-field select { flex:1; min-width:180px; }
  .settings-btn { background:none; border:1px solid var(--bg-border); color:var(--text-secondary); padding:6px 14px; border-radius:4px; font-size:12px; cursor:pointer; }
  .settings-btn:hover { border-color:var(--gold); color:var(--gold); }
  .settings-btn--primary { background:var(--gold); border-color:var(--gold); color:#0a0a14; font-weight:600; }
  .settings-btn--primary:hover { background:var(--gold-light); }
  .settings-btn--danger:hover { border-color:var(--red); color:var(--red); }
  .join-code-box { font-family:"DM Mono",monospace; font-size:20px; letter-spacing:4px; background:var(--bg-raised); border:1px solid var(--bg-border); border-radius:6px; padding:8px 16px; color:var(--text-primary); }
  .join-code-box--inactive { opacity:0.4; }
  /* ===== RESET & BASE ===== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
      color: #e0e0e0;
      line-height: 1.5;
    }
    button { cursor: pointer; font-family: inherit; }
    input, select, textarea { font-family: inherit; }
    a { color: inherit; text-decoration: none; }

    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #666; }

    /* ===== TOAST ===== */
    #toast-container {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      z-index: 9999; display: flex; flex-direction: column; align-items: center; gap: 8px;
      pointer-events: none;
    }
    .toast {
      padding: 10px 24px; border-radius: 8px; font-size: 14px; font-weight: 500;
      color: #fff; opacity: 0; transform: translateY(12px);
      animation: toastIn 0.3s forwards, toastOut 0.3s 2.2s forwards;
      pointer-events: auto; white-space: nowrap;
    }
    .toast--info { background: #2a2a3e; border: 1px solid #3a3a4e; }
    .toast--error { background: #6b1520; border: 1px solid #e63946; }
    .toast--success { background: #1a4a2a; border: 1px solid #2d8a4e; }
    @keyframes toastIn { to { opacity: 1; transform: translateY(0); } }
    @keyframes toastOut { to { opacity: 0; transform: translateY(-8px); } }

    /* ===== LOGIN OVERLAY ===== */
    #login-overlay {
      position: fixed; inset: 0; z-index: 2000;
      background: radial-gradient(ellipse at center, var(--bg-deep) 0%, #000 100%);
      display: flex; align-items: center; justify-content: center;
    }
    .login-card {
      background: var(--bg-card); border: 1px solid var(--bg-border); border-radius: 16px;
      padding: 48px 40px; width: 380px; max-width: 90vw; text-align: center;
      box-shadow: 0 24px 80px rgba(0,0,0,0.5);
    }
    .login-card h1 {
      font-family: 'Instrument Serif', serif; font-size: 56px;
      color: #d4af37; margin-bottom: 4px; letter-spacing: 4px;
    }
    .login-card .subtitle {
      font-family: 'Playfair Display', serif; font-size: 14px;
      color: #888; margin-bottom: 32px; letter-spacing: 1px;
    }
    .login-card input {
      width: 100%; padding: 12px 16px; margin-bottom: 12px;
      background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 8px;
      color: #e0e0e0; font-size: 14px; outline: none; transition: border-color 0.2s;
    }
    .login-card input:focus { border-color: #d4af37; }
    .login-card input::placeholder { color: #555; }
    .login-btn {
      width: 100%; padding: 12px; margin-top: 8px;
      background: #d4af37; color: #0f0f1e; border: none; border-radius: 8px;
      font-size: 15px; font-weight: 600; letter-spacing: 0.5px; transition: background 0.2s;
    }
    .login-btn:hover { background: #e0c04a; }
    .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .login-error { color: #e63946; font-size: 13px; margin-top: 12px; min-height: 20px; }

    /* ===== DASHBOARD ===== */
    #dashboard-view {
      position: fixed; inset: 0; z-index: 100;
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
      overflow-y: auto; display: none;
    }
    .dash-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 24px; border-bottom: 1px solid var(--bg-border);
      background: var(--bg-base);
      position: sticky; top: 0; z-index: 10;
    }
    .dash-header .logo { font-family: 'Instrument Serif', serif; font-size: 28px; color: #d4af37; letter-spacing: 3px; }
    .dash-header-right { display: flex; align-items: center; gap: 12px; }
    .dash-header .user-email { font-size: 13px; color: #888; }
    .dash-logout-btn {
      padding: 6px 16px; background: transparent; border: 1px solid #2a2a3e;
      color: #aaa; border-radius: 6px; font-size: 13px; transition: all 0.2s;
    }
    .dash-logout-btn:hover { border-color: #e63946; color: #e63946; }
    .dash-body { max-width: 960px; margin: 0 auto; padding: 32px 24px; }
    .dash-section-title { font-family: 'Playfair Display', serif; font-size: 22px; color: #d4af37; margin-bottom: 20px; }
    .dash-actions { display: flex; gap: 12px; margin-bottom: 32px; flex-wrap: wrap; }
    .dash-action-btn {
      padding: 10px 20px; background: #1a1a2e; border: 1px dashed #d4af37;
      color: #d4af37; border-radius: 8px; font-size: 14px; transition: all 0.2s;
    }
    .dash-action-btn:hover { background: #2a2a3e; }
    .productions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .production-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 20px; transition: border-color 0.2s;
    }
    .production-card:hover { border-color: #d4af37; }
    .production-card h3 { font-family: 'Playfair Display', serif; font-size: 18px; color: #e0e0e0; margin-bottom: 8px; }
    .role-badge {
      display: inline-block; padding: 2px 10px; border-radius: 12px;
      font-size: 11px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;
    }
    .role-badge--owner { background: #d4af37; color: #0f0f1e; }
    .role-badge--member { background: #3a3a4e; color: #aaa; }
    .production-card .meta { font-size: 12px; color: #666; margin-top: 8px; }
    .production-card .open-btn {
      margin-top: 12px; padding: 8px 20px; background: #d4af37; color: #0f0f1e;
      border: none; border-radius: 6px; font-size: 13px; font-weight: 600; transition: background 0.2s;
    }
    .production-card .open-btn:hover { background: #e0c04a; }
    .empty-state { color: #555; font-size: 14px; text-align: center; padding: 40px 0; }

    /* ===== CREATE / JOIN MODALS ===== */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6);
      z-index: 300; display: flex; align-items: center; justify-content: center;
    }
    .modal-card {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 32px; width: 420px; max-width: 90vw;
    }
    .modal-card h2 { font-family: 'Playfair Display', serif; font-size: 20px; color: #d4af37; margin-bottom: 20px; }
    .modal-card label { display: block; font-size: 13px; color: #888; margin-bottom: 6px; }
    .modal-card input[type="text"], .modal-card input[type="file"] {
      width: 100%; padding: 10px 14px; margin-bottom: 16px;
      background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 6px;
      color: #e0e0e0; font-size: 14px; outline: none;
    }
    .modal-card input:focus { border-color: #d4af37; }
    .modal-btns { display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px; }
    .modal-btn-primary {
      padding: 8px 20px; background: #d4af37; color: #0f0f1e; border: none;
      border-radius: 6px; font-size: 13px; font-weight: 600;
    }
    .modal-btn-primary:hover { background: #e0c04a; }
    .modal-btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .modal-btn-cancel {
      padding: 8px 20px; background: transparent; border: 1px solid #2a2a3e;
      color: #aaa; border-radius: 6px; font-size: 13px;
    }
    .modal-btn-cancel:hover { border-color: #555; color: #e0e0e0; }
    .upload-progress {
      width: 100%; height: 4px; background: #2a2a3e; border-radius: 2px;
      margin-bottom: 12px; overflow: hidden; display: none;
    }
    .upload-progress-bar { height: 100%; background: #d4af37; width: 0%; transition: width 0.3s; }

    /* ===== MAIN APP SHELL ===== */
    #app-view { background: var(--bg-base); position: fixed; inset: 0; display: none; flex-direction: column; z-index: 50; }
    .app-header {
      display: flex; align-items: center; gap: 16px;
      padding: 10px 20px; border-bottom: 1px solid #2a2a3e;
      background: rgba(15,15,30,0.92); backdrop-filter: blur(8px);
      flex-shrink: 0; z-index: 60;
    }
    .app-header .logo {
      font-family: 'Instrument Serif', serif; font-size: 24px;
      color: #d4af37; letter-spacing: 2px; cursor: pointer; transition: opacity 0.2s;
    }
    .app-header .logo:hover { opacity: 0.8; }
    .app-header .prod-title { font-family: 'Playfair Display', serif; font-size: 16px; color: #ccc; }
    .app-header .spacer { flex: 1; }
    .app-header-btn {
      padding: 6px 14px; background: transparent; border: 1px solid #2a2a3e;
      color: #aaa; border-radius: 6px; font-size: 12px; transition: all 0.2s;
    }
    .app-header-btn:hover { border-color: #d4af37; color: #d4af37; }
    .app-header-btn--accent { border-color: #d4af37; color: #d4af37; }
    .app-header-btn--accent:hover { background: #d4af37; color: #0f0f1e; }
    .app-header .gear-btn { background: none; border: none; color: #888; font-size: 18px; transition: color 0.2s; padding: 4px 8px; }
    .app-header .gear-btn:hover { color: #d4af37; }

    /* ===== PROPS TABS ===== */
    .props-subtabs { display: flex; border-bottom: 1px solid #2a2a3e; background: #12122a; flex-shrink: 0; }
    .props-subtab {
      padding: 10px 24px; background: none; border: none; color: #888; font-size: 13px; font-weight: 500;
      border-bottom: 2px solid transparent; transition: all 0.2s;
    }
    .props-subtab:hover { color: #ccc; }
    .props-subtab--active { color: #d4af37; border-bottom-color: #d4af37; }
    .props-content { flex: 1; overflow-y: auto; padding: 24px; }

    /* ===== PROP FORM ===== */
    .prop-form {
      background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px;
      padding: 24px; margin-bottom: 24px;
    }
    .prop-form h3 { font-family: 'Playfair Display', serif; font-size: 18px; color: #d4af37; margin-bottom: 16px; }
    .form-row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .form-row label { font-size: 13px; color: #888; min-width: 100px; }
    .form-input {
      padding: 8px 12px; background: #0f0f1e; border: 1px solid #2a2a3e;
      border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none; transition: border-color 0.2s;
    }
    .form-input:focus { border-color: #d4af37; }
    .form-select {
      padding: 8px 12px; background: #0f0f1e; border: 1px solid #2a2a3e;
      border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none; appearance: none; cursor: pointer;
    }
    .cue-rows { margin: 16px 0; }
    .cue-row {
      display: flex; gap: 8px; align-items: center; margin-bottom: 8px;
      padding: 10px; background: #12122a; border-radius: 8px; flex-wrap: wrap;
    }
    .cue-row .cue-num { font-family: 'DM Mono', monospace; color: #d4af37; font-size: 12px; min-width: 32px; text-align: center; }
    .cue-row .arrow { color: #555; font-size: 14px; }
    .cue-row input { width: 70px; }
    .cue-row select { width: auto; }
    .cue-row .carrier-input { width: 110px; }
    .cue-row .remove-cue-btn { background: none; border: none; color: #e63946; font-size: 16px; padding: 4px 8px; transition: opacity 0.2s; }
    .cue-row .remove-cue-btn:hover { opacity: 0.7; }
    .add-cue-btn {
      padding: 8px 16px; background: transparent; border: 1px dashed #2a2a3e;
      color: #888; border-radius: 6px; font-size: 13px; transition: all 0.2s; width: 100%;
    }
    .add-cue-btn:hover { border-color: #d4af37; color: #d4af37; }
    .form-actions { display: flex; gap: 10px; margin-top: 16px; }

    /* ===== PROPS TABLE ===== */
    .props-table-wrap { overflow-x: auto; }
    .props-table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .props-table th {
      text-align: left; padding: 10px 12px; color: #888; font-size: 12px;
      font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #2a2a3e;
    }
    .props-table td { padding: 10px 12px; border-bottom: 1px solid #1a1a3e; }
    .props-table tr:hover td { background: rgba(212,175,55,0.03); }
    .cue-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-family: 'DM Mono', monospace; margin: 2px; }
    .cue-tag--enter { background: #1a3a2a; color: #4caf50; }
    .cue-tag--exit { background: #3a1a1a; color: #e63946; }

    /* ===== STAGE VIEW ===== */
    .stage-nav {
      display: flex; align-items: center; gap: 16px; margin-bottom: 20px;
      padding: 12px 16px; background: #1a1a2e; border-radius: 8px;
    }
    .stage-nav .page-display { font-family: 'DM Mono', monospace; font-size: 16px; color: #d4af37; min-width: 80px; text-align: center; }
    .stage-nav button {
      padding: 6px 14px; background: #0f0f1e; border: 1px solid #2a2a3e;
      color: #ccc; border-radius: 6px; font-size: 13px; transition: all 0.2s;
    }
    .stage-nav button:hover { border-color: #d4af37; color: #d4af37; }
    .stage-columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; min-height: 300px; }
    .stage-col { border-radius: 12px; padding: 16px; min-height: 200px; }
    .stage-col--sl { background: var(--bg-raised); border-left: 3px solid var(--green); }
    .stage-col--on { background: var(--bg-raised); border-left: 3px solid var(--gold); }
    .stage-col--sr { background: var(--bg-raised); border-left: 3px solid var(--blue); }
    .stage-col h4 { font-family: 'Playfair Display', serif; font-size: 14px; color: rgba(255,255,255,0.7); margin-bottom: 12px; text-align: center; text-transform: uppercase; letter-spacing: 1px; }
    .stage-prop { background: rgba(0,0,0,0.25); border-radius: 8px; padding: 10px 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; }
    .stage-prop:hover { border-color: rgba(255,255,255,0.15); }
    .stage-prop--warn { border-color: #d4af37; box-shadow: 0 0 12px rgba(212,175,55,0.15); }
    .stage-prop--crossover { border-color: #e63946; box-shadow: 0 0 12px rgba(230,57,70,0.2); }
    .stage-prop--crossover.stage-prop--warn { border-color: #e63946; }
    .prop-crossover-alert { font-size: 11px; color: #e63946; margin-top: 4px; font-weight: 500; font-family: 'DM Mono', monospace; }
    .prop-crossover-alert em { font-style: italic; color: #e6394688; }
    .cue-crossover-alert { font-size: 11px; color: #e63946; font-weight: 500; font-family: 'DM Mono', monospace; margin-top: 4px; grid-column: 1 / -1; }
    .cue-enter-loc { max-width: 60px; }
    .cue-mover { max-width: 120px; }
    .stage-prop .prop-name { font-weight: 600; font-size: 14px; }
    .stage-prop .prop-carrier { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 2px; }

    /* ===== PROP NOTES MODAL ===== */
    .prop-notes-modal { position: fixed; inset: 0; z-index: 400; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; }
    .prop-notes-card { background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px; padding: 24px; width: 520px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
    .prop-notes-card h3 { font-family: 'Playfair Display', serif; font-size: 18px; color: #d4af37; margin-bottom: 12px; }
    .prop-notes-card .cue-summary { font-size: 13px; color: #888; margin-bottom: 16px; }
    .prop-notes-card textarea { width: 100%; min-height: 120px; padding: 12px; background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 8px; color: #e0e0e0; font-size: 14px; resize: vertical; outline: none; }
    .prop-notes-card textarea:focus { border-color: #d4af37; }
    .prop-notes-card textarea:disabled { opacity: 0.6; cursor: not-allowed; }

    /* ===== PRE/POST CHECK ===== */
    .check-section { margin-bottom: 32px; }
    .check-section h3 { font-family: 'Playfair Display', serif; font-size: 18px; color: #d4af37; margin-bottom: 4px; }
    .check-progress { font-size: 12px; color: #888; margin-bottom: 12px; }
    .check-progress .badge { display: inline-block; padding: 2px 8px; border-radius: 10px; font-weight: 600; margin-left: 8px; }
    .check-progress .badge--done { background: #1a4a2a; color: #4caf50; }
    .check-progress .badge--pending { background: #3a3a1a; color: #d4af37; }
    .check-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
    .check-card { background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.2s; user-select: none; }
    .check-card:hover { border-color: #555; }
    .check-card--checked { border-color: #2d8a4e; background: #1a2a20; }
    .check-card .check-name { font-weight: 600; font-size: 14px; }
    .check-card .check-detail { font-size: 12px; color: #888; margin-top: 2px; }
    .check-card .check-mark { float: right; font-size: 18px; }
    .reset-checks-btn { margin-top: 12px; padding: 6px 16px; background: transparent; border: 1px solid #2a2a3e; color: #888; border-radius: 6px; font-size: 12px; }
    .reset-checks-btn:hover { border-color: #e63946; color: #e63946; }

    /* ===== SHOW TIMER ===== */
    .timer-panel { background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .timer-panel h3 { font-family: 'Playfair Display', serif; font-size: 16px; color: #d4af37; margin-bottom: 12px; }
    .timer-inputs { display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap; }
    .timer-inputs label { font-size: 12px; color: #888; }
    .timer-inputs input { width: 80px; padding: 6px 10px; background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none; }
    .timer-inputs input:focus { border-color: #d4af37; }
    .timer-btns { display: flex; gap: 8px; margin-bottom: 12px; }
    .timer-btn { padding: 6px 16px; border-radius: 6px; font-size: 13px; border: none; font-weight: 600; transition: opacity 0.2s; }
    .timer-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .timer-btn--start { background: #2d8a4e; color: #fff; }
    .timer-btn--hold { background: #d4af37; color: #0f0f1e; }
    .timer-btn--stop { background: #e63946; color: #fff; }
    .timer-progress { width: 100%; height: 6px; background: #2a2a3e; border-radius: 3px; margin-bottom: 8px; }
    .timer-progress-bar { height: 100%; background: #d4af37; border-radius: 3px; width: 0%; transition: width 0.5s; }
    .timer-display { display: flex; gap: 16px; font-size: 13px; color: #888; font-family: 'DM Mono', monospace; }

    /* ===== PRODUCTION SETTINGS PANEL ===== */
    #production-panel {
      position: fixed; top: 0; right: -480px; bottom: 0; width: 460px; max-width: 100vw;
      background: #1a1a2e; border-left: 1px solid #2a2a3e; z-index: 250;
      overflow-y: auto; transition: right 0.3s ease; padding: 24px;
    }
    #production-panel.open { right: 0; }
    #production-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 240; display: none; }
    #production-backdrop.open { display: block; }
    .panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
    .panel-header h2 { font-family: 'Playfair Display', serif; font-size: 20px; color: #d4af37; }
    .panel-close { background: none; border: none; color: #888; font-size: 20px; padding: 4px 8px; }
    .panel-close:hover { color: #e0e0e0; }
    .panel-section { margin-bottom: 24px; }
    .panel-section h4 { font-size: 13px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; border-bottom: 1px solid #2a2a3e; padding-bottom: 6px; }
    .panel-section input[type="text"] { width: 100%; padding: 8px 12px; background: #0f0f1e; border: 1px solid #2a2a3e; border-radius: 6px; color: #e0e0e0; font-size: 14px; outline: none; }
    .panel-section input:focus { border-color: #d4af37; }
    .join-code-display { font-family: 'DM Mono', monospace; font-size: 20px; color: #d4af37; letter-spacing: 3px; margin-bottom: 8px; }
    .join-code-inactive { color: #555; text-decoration: line-through; }
    .panel-btn { padding: 6px 14px; background: #0f0f1e; border: 1px solid #2a2a3e; color: #ccc; border-radius: 6px; font-size: 12px; transition: all 0.2s; }
    .panel-btn:hover { border-color: #d4af37; color: #d4af37; }
    .panel-btn--danger:hover { border-color: #e63946; color: #e63946; }
    .member-list { list-style: none; }
    .member-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #1a1a3e; font-size: 13px; }
    .member-item .member-email { flex: 1; color: #ccc; }
    .member-item .member-actions { display: flex; gap: 6px; }
    .member-item .member-actions button { padding: 3px 10px; background: none; border: 1px solid #2a2a3e; color: #888; border-radius: 4px; font-size: 11px; cursor: pointer; }
    .member-item .member-actions button:hover { border-color: #d4af37; color: #d4af37; }
    .member-item .member-actions .remove-btn:hover { border-color: #e63946; color: #e63946; }

    /* ===== LINE NOTES OVERLAY ===== */
    #linenotes-overlay {
      position: fixed; inset: 0; z-index: 500;
      background: var(--bg-deep); display: none; flex-direction: column;
    }
    #linenotes-overlay.open { display: flex; }

    /* Line Notes Header */
    .ln-header {
      display: flex; align-items: center; gap: 12px;
      padding: 8px 16px; border-bottom: 1px solid var(--bg-border);
      background: var(--bg-card); flex-shrink: 0;
    }
    .ln-header .back-btn {
      background: none; border: 1px solid var(--bg-border); color: var(--text-secondary);
      padding: 4px 12px; border-radius: 6px; font-size: 12px; transition: all 0.2s;
    }
    .ln-header .back-btn:hover { border-color: var(--gold); color: var(--gold); }
    .ln-header .ln-logo {
      font-family: 'Instrument Serif', serif; font-size: 20px; color: var(--gold); letter-spacing: 2px;
    }
    .ln-header .show-name {
      font-family: 'Inter', sans-serif; font-size: 13px; color: var(--text-secondary);
    }
    .ln-header .ln-spacer { flex: 1; }
    .ln-header-btn {
      padding: 5px 12px; background: transparent; border: 1px solid var(--bg-border);
      color: var(--text-secondary); border-radius: 5px; font-size: 12px; font-family: 'Inter', sans-serif;
      transition: all 0.2s;
    }
    .ln-header-btn:hover { border-color: var(--gold); color: var(--gold); }
    .ln-header-btn--active { border-color: var(--gold); color: var(--gold); background: rgba(200,169,110,0.1); }
    .ln-page-nav { display: flex; align-items: center; gap: 8px; }
    .ln-page-nav .page-num {
      font-family: 'DM Mono', monospace; font-size: 13px; color: var(--gold); min-width: 60px; text-align: center;
    }
    .ln-page-nav button {
      background: none; border: 1px solid var(--bg-border); color: var(--text-secondary);
      padding: 4px 10px; border-radius: 4px; font-size: 13px;
    }
    .ln-page-nav button:hover { border-color: var(--gold); color: var(--gold); }

    /* Line Notes Body */
    .ln-body { display: flex; flex: 1; overflow: hidden; }

    /* Line Notes Sidebar */
    .ln-sidebar {
      width: 280px; min-width: 280px; border-right: 1px solid var(--bg-border);
      background: var(--bg-card); display: flex; flex-direction: column; overflow-y: auto;
    }
    .ln-sidebar-section { padding: 12px; border-bottom: 1px solid var(--bg-border); }
    .ln-sidebar-section h5 {
      font-family: 'Inter', sans-serif; font-size: 11px; color: var(--text-muted);
      text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;
    }
    .char-item {
      display: flex; align-items: center; gap: 8px; padding: 5px 8px;
      border-radius: 5px; cursor: pointer; font-size: 13px; color: var(--text-primary); transition: background 0.15s;
    }
    .char-item:hover { background: var(--bg-raised); }
    .char-item--active { background: var(--bg-raised); }
    .char-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .char-item .char-count { margin-left: auto; font-size: 11px; color: var(--text-muted); font-family: 'DM Mono', monospace; }
    .char-item .delete-char {
      margin-left: 4px; background: none; border: none; color: var(--text-muted);
      font-size: 14px; cursor: pointer; padding: 0 4px; opacity: 0; transition: opacity 0.15s;
    }
    .char-item:hover .delete-char { opacity: 1; }
    .char-item .delete-char:hover { color: #e63946; }
    .add-char-btn {
      padding: 4px 10px; background: none; border: 1px dashed #2e2c29;
      color: var(--text-muted); border-radius: 4px; font-size: 12px; width: 100%;
      margin-top: 6px; transition: all 0.2s;
    }
    .add-char-btn:hover { border-color: var(--gold); color: var(--gold); }

    /* Note types */
    .note-types { display: flex; gap: 4px; flex-wrap: wrap; }
    .note-type-btn {
      padding: 4px 10px; background: var(--bg-raised); border: 1px solid var(--bg-border);
      color: var(--text-secondary); border-radius: 4px; font-size: 11px; font-family: 'DM Mono', monospace;
      transition: all 0.15s;
    }
    .note-type-btn:hover { border-color: var(--gold); }
    .note-type-btn--active { border-color: var(--gold); color: var(--gold); background: rgba(200,169,110,0.08); }

    /* Notes list */
    .notes-list { flex: 1; overflow-y: auto; }
    .note-item {
      display: flex; gap: 8px; padding: 8px 12px; border-bottom: 1px solid #232220;
      cursor: pointer; transition: background 0.15s; font-size: 12px;
    }
    .note-item:hover { background: var(--bg-raised); }
    .note-color-bar { width: 3px; border-radius: 2px; flex-shrink: 0; }
    .note-item-content { flex: 1; min-width: 0; }
    .note-item-header { display: flex; gap: 6px; align-items: center; margin-bottom: 2px; }
    .note-page { font-family: 'DM Mono', monospace; color: var(--text-muted); font-size: 10px; }
    .note-char-name { color: var(--gold); font-size: 11px; font-weight: 500; }
    .note-type-label {
      font-family: 'DM Mono', monospace; font-size: 10px; padding: 1px 5px;
      background: var(--bg-raised); border-radius: 3px; color: var(--text-secondary);
    }
    .note-text-preview {
      color: var(--text-muted); font-style: italic; font-size: 11px;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
    .note-delete-btn {
      background: none; border: none; color: var(--text-muted); font-size: 14px;
      cursor: pointer; padding: 0 4px; opacity: 0; transition: opacity 0.15s; align-self: center;
    }
    .note-item:hover .note-delete-btn { opacity: 1; }
    .note-delete-btn:hover { color: #e63946; }

    /* Line Notes canvas area */
    .ln-canvas-area {
      flex: 1; overflow: auto; display: flex; justify-content: center;
      padding: 20px; background: var(--bg-deep); position: relative;
    }
    .ln-canvas-container {
      position: relative; display: inline-block; box-shadow: 0 4px 32px rgba(0,0,0,0.5);
    }
    .ln-canvas-container canvas { display: block; }
    .zones-layer { position: absolute; inset: 0; pointer-events: none; }

    /* Line zones */
    .line-zone {
      position: absolute; border-radius: 2px; cursor: pointer;
      pointer-events: all; transition: background 0.15s;
    }
    .line-zone:hover { background: rgba(200,169,110,0.15); }
    .line-zone--char { background: rgba(91,155,212,0.08); }
    .line-zone--stage-dir { background: rgba(128,128,128,0.06); }
    .line-zone--has-note { border-bottom: 2px solid; }
    .note-type-tag {
      position: absolute; right: -34px; top: 50%; transform: translateY(-50%);
      font-family: 'DM Mono', monospace; font-size: 9px; padding: 1px 4px;
      border-radius: 3px; color: #fff; white-space: nowrap;
    }

    /* Zone editor panel */
    .zone-editor-panel {
      width: 300px; min-width: 300px; border-left: 1px solid var(--bg-border);
      background: var(--bg-card); overflow-y: auto; padding: 12px; display: none;
    }
    .zone-editor-panel.open { display: block; }
    .zone-editor-panel h5 {
      font-size: 11px; color: var(--text-muted); text-transform: uppercase;
      letter-spacing: 1px; margin-bottom: 8px;
    }
    .zone-toolbar { display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 12px; }
    .zone-toolbar button {
      padding: 4px 10px; background: var(--bg-raised); border: 1px solid var(--bg-border);
      color: var(--text-secondary); border-radius: 4px; font-size: 11px; transition: all 0.15s;
    }
    .zone-toolbar button:hover { border-color: var(--gold); color: var(--gold); }
    .zone-detail { margin-bottom: 12px; }
    .zone-detail label { display: block; font-size: 11px; color: var(--text-muted); margin-bottom: 3px; }
    .zone-detail input, .zone-detail textarea {
      width: 100%; padding: 6px 8px; background: var(--bg-raised); border: 1px solid var(--bg-border);
      border-radius: 4px; color: var(--text-primary); font-size: 12px; outline: none;
    }
    .zone-detail input:focus, .zone-detail textarea:focus { border-color: var(--gold); }
    .zone-detail textarea { min-height: 60px; resize: vertical; font-family: 'Inter', sans-serif; }
    .zone-list-item {
      display: flex; gap: 6px; align-items: center; padding: 5px 8px;
      border-radius: 4px; cursor: pointer; font-size: 11px; color: var(--text-secondary); transition: background 0.15s;
    }
    .zone-list-item:hover { background: var(--bg-raised); }
    .zone-list-item--selected { background: var(--bg-raised); border: 1px solid #c8a96e; }
    .zone-list-item .zone-type-label {
      font-family: 'DM Mono', monospace; font-size: 9px; padding: 1px 5px;
      background: #2e2c29; border-radius: 3px;
    }
    .zone-list-item .zone-text { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .zone-list-item .zone-delete {
      background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 12px;
      opacity: 0; transition: opacity 0.15s;
    }
    .zone-list-item:hover .zone-delete { opacity: 1; }
    .zone-list-item .zone-delete:hover { color: #e63946; }
    .zone-saved-badge {
      display: inline-block; padding: 2px 8px; background: #1a4a2a;
      color: #4caf50; border-radius: 4px; font-size: 11px; margin-left: 8px;
      opacity: 0; transition: opacity 0.3s;
    }
    .zone-saved-badge.visible { opacity: 1; }
    .multi-select-bar {
      padding: 8px; background: rgba(200,169,110,0.1); border: 1px solid #c8a96e;
      border-radius: 6px; margin-bottom: 8px; display: none;
    }
    .multi-select-bar.open { display: block; }
    .multi-select-bar span { font-size: 12px; color: var(--gold); }
    .multi-select-bar button {
      padding: 3px 8px; background: none; border: 1px solid var(--bg-border);
      color: var(--text-secondary); border-radius: 3px; font-size: 11px; margin-left: 4px;
    }
    .multi-select-bar button:hover { border-color: var(--gold); color: var(--gold); }

    /* Popover */
    .note-popover {
      position: fixed; z-index: 600; background: var(--bg-card); border: 1px solid var(--bg-border);
      border-radius: 8px; padding: 0; width: 260px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7); display: none;
      font-family: 'Inter', sans-serif; overflow: hidden;
      flex-direction: column;
    }
    .note-popover.open { display: flex; flex-direction: column; }
    /* Line text preview at top */
    .popover-line-text {
      font-family: 'Instrument Serif', serif; font-style: italic;
      font-size: 13px; color: var(--text-primary); line-height: 1.5;
      padding: 10px 14px 8px; border-bottom: 1px solid var(--bg-border);
      background: #141312;
      max-height: 80px; overflow-y: auto; display: none;
    }
    /* Section label */
    .popover-section-label {
      font-family: 'DM Mono', monospace; font-size: 9px; letter-spacing: 0.1em;
      text-transform: uppercase; color: #3d3a36; padding: 8px 14px 4px;
    }
    /* Cast selector */
    .popover-chars { display: flex; flex-direction: column; gap: 2px; padding: 0 8px 6px; }
    .popover-char {
      display: flex; align-items: center; gap: 8px; padding: 5px 8px;
      background: transparent; border: 1px solid transparent; border-radius: 4px;
      font-size: 12px; color: var(--text-secondary); cursor: pointer; transition: all 0.1s;
    }
    .popover-char:hover { background: var(--bg-raised); color: var(--text-primary); }
    .popover-char--active { background: var(--bg-raised); border-color: #3d3a36; color: var(--text-primary); }
    .popover-char .pop-char-dot { flex-shrink: 0; }
    .popover-char .char-label { flex: 1; }
    .popover-char .shortcut-key {
      font-family: 'DM Mono', monospace; font-size: 9px; color: #3d3a36;
      background: var(--bg-deep); border: 1px solid var(--bg-border); border-radius: 2px;
      padding: 1px 4px; line-height: 1.5; min-width: 14px; text-align: center;
    }
    .popover-char--active .shortcut-key { color: var(--text-muted); border-color: #3d3a36; }
    /* Note type strip */
    .popover-types {
      display: flex; gap: 3px; padding: 6px 8px 8px; border-top: 1px solid var(--bg-border);
    }
    .popover-type {
      flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px;
      padding: 6px 2px 5px;
      background: var(--bg-raised); border: 1px solid var(--bg-border); border-radius: 4px;
      font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 500;
      color: var(--text-muted); cursor: pointer; transition: all 0.1s;
    }
    .popover-type:hover { border-color: var(--text-muted); color: var(--text-secondary); background: #2a2825; }
    .popover-type--active { border-color: var(--gold); color: var(--gold); background: rgba(200,169,110,0.07); }
    .popover-type .type-key {
      font-size: 8px; color: #3d3a36; font-family: 'DM Mono', monospace;
      background: var(--bg-card); border: 1px solid var(--bg-border); border-radius: 2px;
      padding: 0 3px; line-height: 1.6; min-width: 12px; text-align: center;
      transition: all 0.1s;
    }
    .popover-type--active .type-key { color: #7a6a3a; border-color: #5c4a20; background: var(--bg-deep); }
    /* Confirm/cancel row */
    .popover-btns {
      display: flex; gap: 6px; padding: 8px 8px 8px; border-top: 1px solid var(--bg-border);
      justify-content: flex-end;
    }
    .popover-btn {
      padding: 5px 14px; border-radius: 4px; font-size: 12px;
      font-weight: 500; cursor: pointer; transition: all 0.1s;
      font-family: 'Inter', sans-serif;
    }
    .popover-btn--confirm { background: #c8a96e; color: #0f0e0c; border: 1px solid #c8a96e; }
    .popover-btn--confirm:hover { background: #d4b97e; border-color: #d4b97e; }
    .popover-btn--cancel { background: transparent; color: var(--text-muted); border: 1px solid var(--bg-border); }
    .popover-btn--cancel:hover { color: var(--text-secondary); border-color: #3d3a36; }

    /* Processing overlay */
    .processing-overlay {
      position: absolute; inset: 0; background: rgba(15,14,12,0.9);
      display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 550;
    }
    .processing-overlay.open { display: flex; }
    .processing-overlay .text {
      font-family: 'Instrument Serif', serif; font-size: 18px; color: var(--gold); margin-bottom: 16px;
    }
    .processing-bar { width: 240px; height: 4px; background: #2e2c29; border-radius: 2px; overflow: hidden; }
    .processing-bar-fill { height: 100%; background: #c8a96e; width: 0%; transition: width 0.4s; }

    /* Send notes modal */
    .send-notes-modal {
      position: fixed; inset: 0; z-index: 650; background: rgba(0,0,0,0.6);
      display: none; align-items: center; justify-content: center;
    }
    .send-notes-modal.open { display: flex; }
    .send-notes-card {
      background: var(--bg-card); border: 1px solid var(--bg-border); border-radius: 12px;
      padding: 24px; width: 560px; max-width: 90vw; max-height: 80vh; overflow-y: auto;
    }
    .send-notes-card h3 {
      font-family: 'Instrument Serif', serif; font-size: 20px; color: var(--gold); margin-bottom: 16px;
    }
    .send-char-section { margin-bottom: 16px; }
    .send-char-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .send-char-header .char-name { font-weight: 600; color: var(--text-primary); font-size: 14px; }
    .send-char-header .mail-link { font-size: 12px; color: var(--gold); cursor: pointer; text-decoration: underline; }
    .send-note-row {
      font-size: 12px; color: var(--text-secondary); padding: 4px 0 4px 16px; border-left: 2px solid var(--bg-border);
    }
    .send-notes-actions { display: flex; gap: 10px; margin-top: 16px; }

    /* Character modal */
    .char-modal {
      position: fixed; inset: 0; z-index: 620; background: rgba(0,0,0,0.5);
      display: none; align-items: center; justify-content: center;
    }
    .char-modal.open { display: flex; }
    .char-modal-card {
      background: var(--bg-card); border: 1px solid var(--bg-border); border-radius: 10px;
      padding: 24px; width: 340px;
    }
    .char-modal-card h3 {
      font-family: 'Instrument Serif', serif; font-size: 18px; color: var(--gold); margin-bottom: 16px;
    }
    .char-modal-card input[type="text"] {
      width: 100%; padding: 8px 12px; background: var(--bg-raised); border: 1px solid var(--bg-border);
      border-radius: 6px; color: var(--text-primary); font-size: 14px; outline: none; margin-bottom: 12px;
    }
    .char-modal-card input:focus { border-color: var(--gold); }
    .char-color-grid { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px; }
    .char-color-swatch {
      width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
      border: 2px solid transparent; transition: border-color 0.15s;
    }
    .char-color-swatch:hover { border-color: rgba(255,255,255,0.3); }
    .char-color-swatch--selected { border-color: #fff; }

    /* Run Show — hit overlay children need pointer events */
    #rs-hit-overlay .line-zone { pointer-events: all; }
    #rs-hit-overlay > div { pointer-events: all; }

    /* Ensure rs-draw-overlay passes through pointer events except rubber band */
    #rs-draw-overlay { pointer-events: none; }
    #rs-rubber-band { pointer-events: none; }

    /* ===== RUN SHOW TAB ===== */
    .rs-layout { display:flex; flex:1; overflow:hidden; }
    .rs-sidebar {
      width:280px; min-width:280px; border-right:1px solid var(--bg-border);
      background:var(--bg-card); display:flex; flex-direction:column; overflow-y:auto;
      transition:width 0.25s ease, min-width 0.25s ease, opacity 0.2s ease;
    }
    .rs-sidebar.rs-collapsed {
      width:0; min-width:0; overflow:hidden; opacity:0; border-right:none;
    }
    .rs-sidebar-header {
      display:flex; align-items:center; gap:10px;
      padding:8px 12px; border-bottom:1px solid var(--bg-border); flex-shrink:0;
    }
    .rs-script-area {
      flex:1; overflow:hidden; display:flex; flex-direction:column;
      background:var(--bg-deep); position:relative;
    }
    .rs-controls {
      width:320px; min-width:280px; border-left:1px solid var(--bg-border);
      background:var(--bg-card); display:flex; flex-direction:column; overflow-y:auto;
      transition:width 0.25s ease, min-width 0.25s ease, opacity 0.2s ease;
    }
    .rs-controls.rs-collapsed {
      width:0; min-width:0; overflow:hidden; opacity:0; border-left:none;
    }
    .rs-controls-inner { padding:16px; display:flex; flex-direction:column; gap:14px; }

    /* Collapse toggle buttons */
    .rs-collapse-btn {
      position:absolute; top:50%; z-index:30; width:20px; height:48px;
      background:var(--bg-raised); border:1px solid var(--bg-border); color:var(--text-secondary);
      font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:all 0.2s; padding:0;
    }
    .rs-collapse-btn:hover { background:#2e2c29; color:var(--text-primary); border-color:var(--text-muted); }
    .rs-collapse-btn--left {
      left:0; transform:translateY(-50%); border-radius:0 6px 6px 0; border-left:none;
    }
    .rs-collapse-btn--right {
      right:0; transform:translateY(-50%); border-radius:6px 0 0 6px; border-right:none;
    }

    /* Run Show — Start button */
    .rs-start-run-btn {
      width:100%; padding:12px; background:#2d8a4e; color:#fff; border:none;
      border-radius:8px; font-size:15px; font-weight:600; cursor:pointer; transition:background 0.2s;
    }
    .rs-start-run-btn:hover { background:#38a05e; }

    /* Run Show — session header */
    .rs-session-header {
      display:flex; align-items:center; gap:10px;
      background:var(--bg-raised); border-radius:8px; padding:10px 14px; flex-shrink:0;
    }
    .rs-session-title { flex:1; font-size:13px; color:var(--text-primary); font-weight:500; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .rs-session-elapsed { font-family:'DM Mono',monospace; font-size:14px; color:var(--gold); }
    .rs-end-run-btn {
      padding:6px 14px; background:#6b1520; border:1px solid #e63946; color:#e63946;
      border-radius:5px; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s;
    }
    .rs-end-run-btn:hover { background:#e63946; color:#fff; }

    /* Run Show — timer panel */
    .rs-timer-panel { background:var(--bg-raised); border-radius:8px; padding:14px; }
    .rs-timer-progress { width:100%; height:6px; background:#2a2a3e; border-radius:3px; margin-bottom:8px; }
    .rs-timer-progress-bar { height:100%; background:#d4af37; border-radius:3px; width:0%; transition:width 0.5s; }
    .rs-timer-display { display:flex; gap:10px; font-size:11px; color:#888; font-family:'DM Mono',monospace; flex-wrap:wrap; margin-bottom:10px; }
    .rs-timer-btns { display:flex; gap:6px; margin-bottom:8px; }
    .rs-timer-page { font-family:'DM Mono',monospace; font-size:12px; color:var(--text-muted); }

    /* Run Show — timer preview (idle) */
    .rs-timer-preview { display:flex; flex-direction:column; gap:6px; }
    .rs-timer-field { display:flex; justify-content:space-between; align-items:center; font-size:12px; }
    .rs-timer-field label { color:var(--text-muted); }
    .rs-timer-field span { font-family:'DM Mono',monospace; color:var(--text-secondary); }

    /* Run Show — stage columns widget */
    .rs-stage-columns { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; }
    .rs-stage-columns .stage-col { border-radius:8px; padding:10px; }
    .rs-stage-columns .stage-col h4 { font-size:11px; margin-bottom:8px; }

    /* Run Show — scratchpad */
    .rs-scratchpad-section { display:flex; flex-direction:column; gap:6px; }
    .rs-scratchpad-input {
      width:100%; min-height:80px; padding:10px; background:#0f0f1e;
      border:1px solid #2a2a3e; border-radius:6px; color:#e0e0e0;
      font-size:13px; resize:vertical; outline:none; font-family:'DM Mono',monospace;
    }
    .rs-scratchpad-input:focus { border-color:#d4af37; }

    /* Run Show — FAB */
    .run-show-fab {
      position:absolute; bottom:24px; right:24px; z-index:50;
      padding:12px 20px; background:#c8a96e; color:#0f0e0c;
      border:none; border-radius:24px; font-size:14px; font-weight:600;
      box-shadow:0 4px 20px rgba(200,169,110,0.3); cursor:pointer; transition:all 0.2s;
    }
    .run-show-fab:hover { background:#e8c98e; transform:translateY(-1px); }

    /* Quick-entry popover */
    .run-note-popover {
      position:fixed; bottom:80px; right:24px; z-index:600;
      background:var(--bg-card); border:1px solid var(--bg-border); border-radius:10px;
      width:300px; box-shadow:0 12px 40px rgba(0,0,0,0.7);
      font-family:'Inter',sans-serif; overflow:hidden;
    }
    .run-note-popover-inner { padding:14px; display:flex; flex-direction:column; gap:10px; }
    .rnp-page-label { font-family:'DM Mono',monospace; font-size:11px; color:var(--text-muted); letter-spacing:0.08em; }

    /* Run report modal */
    .run-report-modal { z-index:700; }
    .run-report-card {
      background:var(--bg-card); border:1px solid var(--bg-border); border-radius:12px;
      width:90vw; max-width:900px; max-height:90vh; display:flex; flex-direction:column;
    }
    .run-report-header {
      display:flex; align-items:center; justify-content:space-between;
      padding:18px 24px; border-bottom:1px solid var(--bg-border); flex-shrink:0;
    }
    .run-report-header h2 { font-family:'Instrument Serif',serif; font-size:20px; color:var(--gold); }
    .run-report-actions { display:flex; gap:10px; align-items:center; }
    .run-report-body { flex:1; overflow-y:auto; padding:24px; background:#fff; border-radius:0 0 12px 12px; }

    /* Report row in history */
    .rs-report-row:hover { border-color:var(--gold) !important; }

    /* Toast warn type */
    .toast--warn { background:#5a3500; border:1px solid #d4af37; color:#d4af37; }

    /* ===== FEATURE 5: Line Notes Sub-tabs ===== */
    .ln-subtabs { display:flex; border-bottom:1px solid var(--bg-border); padding:0 12px; background:var(--bg-deep); flex-shrink:0; }
    .ln-subtab { height:36px; padding:0 18px; background:none; border:none; border-bottom:2px solid transparent; color:var(--text-muted); font-size:12px; font-weight:500; cursor:pointer; transition:all 0.2s; }
    .ln-subtab:hover { color:var(--text-secondary); }
    .ln-subtab--active { color:var(--gold); border-bottom-color:var(--gold); }

    /* ===== FEATURE 5: Cue type badges ===== */
    .cue-type-badge { display:inline-block; padding:2px 8px; border-radius:10px; font-family:"DM Mono",monospace; font-size:10px; font-weight:500; }
    .cue-type-badge--LX { background:#1A2E50; color:#5B9BD4; }
    .cue-type-badge--SQ { background:#2D1A14; color:#E63946; }
    .cue-type-badge--PX { background:#1A2A1A; color:#2D8A4E; }
    .cue-type-badge--FLY, .cue-type-badge--CARP, .cue-type-badge--OTHER { background:#2E2C29; color:#9A9488; }

    /* ===== FEATURE 5: Cue banner in Run Show ===== */
    .rs-cue-banner { display:flex; gap:6px; flex-wrap:wrap; padding:6px 12px; background:var(--bg-deep); border-bottom:1px solid var(--bg-border); min-height:0; }
    .rs-cue-banner:empty { display:none; }
    .rs-cue-pill { padding:2px 10px; border-radius:12px; font-family:"DM Mono",monospace; font-size:11px; font-weight:500; cursor:pointer; }
    .rs-cue-pill--LX { background:#1A2E50; color:#5B9BD4; }
    .rs-cue-pill--SQ { background:#2D1A14; color:#E63946; }
    .rs-cue-pill--PX { background:#1A2A1A; color:#2D8A4E; }
    .rs-cue-pill--FLY, .rs-cue-pill--CARP, .rs-cue-pill--OTHER { background:#2E2C29; color:#9A9488; }

    /* ===== FEATURE 4: Diagram panel ===== */
    .diagram-panel { width:220px; min-width:220px; border-right:1px solid var(--bg-border); background:#141312; display:flex; flex-direction:column; overflow:hidden; transition:width 0.25s ease, min-width 0.25s ease; }
    .diagram-panel.collapsed { width:24px; min-width:24px; overflow:hidden; }
    .diagram-panel.diagram-expanded { width:100%; min-width:0; flex:1; }
    .diagram-panel img { width:100%; height:auto; border-radius:4px; margin-bottom:8px; }
    .diagram-toggle-btn { width:100%; background:none; border:none; color:var(--text-muted); cursor:pointer; padding:6px 0; font-size:16px; flex-shrink:0; }
    .diagram-toggle-btn:hover { color:var(--text-secondary); }

    /* Diagram viewer (zoom/scroll) */
    .rs-diagram-viewer {
      position:relative; overflow:auto; cursor:grab; flex:1; min-height:0;
      scrollbar-width:thin; scrollbar-color:#444 transparent;
    }
    .rs-diagram-viewer:active { cursor:grabbing; }
    .rs-diagram-viewer-inner {
      transform-origin:0 0; transition:transform 0.1s ease-out;
      display:flex; flex-direction:column; gap:12px; padding:8px; min-width:min-content;
    }
    .rs-diagram-item { position:relative; }
    .rs-diagram-item img {
      display:block; width:100%; height:auto; border-radius:4px;
      user-select:none; -webkit-user-drag:none;
    }
    .rs-diagram-zoom-controls {
      display:flex; gap:4px; padding:4px 8px; border-bottom:1px solid var(--bg-border);
      background:var(--bg-card); flex-shrink:0; align-items:center;
    }
    .rs-diagram-zoom-btn {
      width:26px; height:26px; background:var(--bg-raised); border:1px solid var(--bg-border);
      color:var(--text-secondary); border-radius:4px; cursor:pointer; font-size:14px;
      display:flex; align-items:center; justify-content:center; padding:0;
    }
    .rs-diagram-zoom-btn:hover { background:#2e2c29; color:var(--text-primary); border-color:var(--text-muted); }
    .rs-diagram-zoom-level {
      font-family:'DM Mono',monospace; font-size:10px; color:var(--text-muted);
      min-width:36px; text-align:center;
    }

    /* ===== FEATURE 7: Email Notes modal ===== */
    .email-actor-row { display:flex; align-items:center; gap:10px; padding:10px 0; border-bottom:1px solid var(--bg-border); }
    .email-actor-row:last-of-type { border-bottom:none; }
    .actor-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
    .actor-info { flex:1; min-width:0; display:flex; flex-direction:column; gap:2px; }
    .actor-name { font-size:14px; font-weight:600; color:var(--text-primary); }
    .actor-email { font-family:"DM Mono",monospace; font-size:11px; color:var(--text-muted); }
    .actor-email--warn { color:var(--gold); }
    .actor-note-count { font-family:"DM Mono",monospace; font-size:11px; color:var(--text-muted); flex-shrink:0; }
    .email-notes-meta { font-family:"DM Mono",monospace; font-size:11px; color:var(--text-muted); margin-bottom:16px; }
    .email-open-btn--disabled { opacity:0.35; cursor:not-allowed; pointer-events:none; }

    /* Email All button + warning banner */
    .email-all-section { margin-bottom:16px; }
    .email-all-btn {
      width:100%; padding:12px 20px; background:var(--gold); color:var(--bg-deep);
      border:none; border-radius:8px; font-size:14px; font-weight:600;
      cursor:pointer; transition:background 0.2s, opacity 0.2s;
      font-family:'DM Sans',sans-serif; letter-spacing:0.3px;
    }
    .email-all-btn:hover:not(.email-open-btn--disabled) { background:var(--gold-light, #e0c04a); }
    .email-all-btn.email-open-btn--disabled {
      background:var(--bg-border); color:var(--text-muted);
      opacity:0.5; cursor:not-allowed; pointer-events:none;
    }
    .email-notes-warning {
      background:rgba(212,175,55,0.1); border:1px solid rgba(212,175,55,0.25);
      border-radius:6px; padding:8px 12px; margin-bottom:12px;
      font-family:'DM Mono',monospace; font-size:11px; color:var(--gold);
    }
    .email-single-btn { min-width:60px; text-align:center; }

    /* ===== UTILITY ===== */
    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); border: 0;
    }

    /* ===== ZONE EDITOR (dynamic elements) ===== */
    .ze-zone {
      position: absolute; border: 1px solid rgba(200,169,110,0.5); background: rgba(200,169,110,0.08);
      border-radius: 2px; cursor: grab; transition: background 0.1s, border-color 0.1s;
      display: flex; align-items: flex-start; overflow: hidden;
    }
    .ze-zone:hover { background: rgba(200,169,110,0.2); border-color: rgba(200,169,110,0.9); z-index: 5; }
    .ze-zone.selected { background: rgba(200,169,110,0.18); border-color: var(--gold); border-width: 1.5px; z-index: 10; }
    .ze-zone.ze-char-name { border-color: rgba(91,155,212,0.5); background: rgba(91,155,212,0.06); }
    .ze-zone.ze-char-name:hover { background: rgba(91,155,212,0.15); border-color: rgba(91,155,212,0.9); }
    .ze-zone.selected.ze-char-name { border-color: #5b9bd4; }
    .ze-zone.ze-stage-dir { border-color: rgba(196,92,74,0.45); background: rgba(196,92,74,0.06); cursor: default; }
    .ze-zone.ze-stage-dir:hover { background: rgba(196,92,74,0.12); border-color: rgba(196,92,74,0.7); }
    .ze-zone.ze-stage-dir .ze-zone-label { color: rgba(196,92,74,0.7); }
    .ze-zone.ze-multi-selected { background: rgba(91,155,212,0.18); border-color: #5b9bd4; border-width: 1.5px; }
    .ze-zone-label {
      font-family: 'DM Mono', monospace; font-size: 7.5px; color: rgba(200,169,110,0.75);
      padding: 1px 3px; pointer-events: none; white-space: nowrap; overflow: hidden;
      text-overflow: ellipsis; max-width: 100%; line-height: 1.2;
    }
    .ze-zone.ze-char-name .ze-zone-label { color: rgba(91,155,212,0.8); }
    .ze-resize {
      position: absolute; bottom: 0; right: 0; width: 10px; height: 10px; cursor: nwse-resize; z-index: 15;
    }
    .ze-resize::after {
      content: ''; position: absolute; bottom: 2px; right: 2px;
      width: 5px; height: 5px; border-right: 1.5px solid #c8a96e; border-bottom: 1.5px solid #c8a96e; opacity: 0.7;
    }
    .ze-tool-btn {
      height: 26px; padding: 0 10px; border-radius: 3px; border: 1px solid var(--bg-border);
      background: var(--bg-raised); color: var(--text-secondary); font-family: 'DM Mono', monospace;
      font-size: 10px; cursor: pointer; transition: all 0.12s; display: inline-flex; align-items: center; gap: 4px;
    }
    .ze-tool-btn:hover { background: #2e2c29; color: var(--text-primary); }
    .ze-tool-btn.ze-danger:hover { background: rgba(196,92,74,0.2); color: #c45c4a; border-color: #c45c4a; }
    .ze-tool-btn.ze-accent { background: #c8a96e; color: #0f0e0c; border-color: var(--gold); }
    .ze-tool-btn.ze-accent:hover { background: #e8c98e; }
    .ze-tool-btn kbd {
      font-family: 'DM Mono', monospace; font-size: 9px; background: var(--bg-raised);
      border: 1px solid var(--bg-border); border-radius: 3px; padding: 1px 4px; color: var(--text-muted);
    }
    .ze-label { font-family: 'DM Mono', monospace; font-size: 9px; color: var(--text-muted); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 3px; }
    .ze-input {
      width: 100%; background: var(--bg-raised); border: 1px solid var(--bg-border); border-radius: 3px;
      color: var(--text-primary); font-family: 'DM Mono', monospace; font-size: 12px; padding: 5px 7px; outline: none;
    }
    .ze-input:focus { border-color: var(--gold); }
    #ze-detail { display: none; border-top: 1px solid var(--bg-border); flex-shrink: 0; overflow-y: auto; max-height: 55vh; }
    #ze-detail.visible { display: block; }
    #ze-multi-bar { display: none; }
    #ze-multi-bar.visible { display: flex; }
    .ze-select-all-drag-btn {
      display: block; width: calc(100% - 16px); margin: 8px 8px 4px;
      padding: 7px 10px; font-family: 'DM Mono', monospace; font-size: 11px;
      background: var(--bg-raised); color: #a09880; border: 1px dashed #3d3a36;
      border-radius: 4px; cursor: pointer; text-align: center; flex-shrink: 0;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
    }
    .ze-select-all-drag-btn:hover:not(:disabled) { background: #2e2c29; color: var(--text-primary); border-color: #6a6455; border-style: solid; }
    .ze-select-all-drag-btn.active { background: rgba(200,169,110,0.12); color: var(--gold); border-color: var(--gold); border-style: solid; }
    .ze-select-all-drag-btn:disabled { opacity: 0.35; cursor: not-allowed; }
    #ze-saved-badge.visible { opacity: 1; }

    /* Zone editor list items */
    .ze-list-item {
      display: flex; align-items: flex-start; gap: 8px; padding: 7px 8px;
      border-radius: 4px; cursor: pointer; transition: background 0.1s; border-bottom: 1px solid var(--bg-border);
    }
    .ze-list-item:last-child { border-bottom: none; }
    .ze-list-item:hover { background: var(--bg-raised); }
    .ze-list-item.selected { background: var(--bg-raised); border-left: 2px solid #c8a96e; padding-left: 6px; }
    .ze-list-item.ze-cn-item { border-left: 2px solid rgba(91,155,212,0.4); padding-left: 6px; }
    .ze-list-item.ze-cn-item.selected { border-left-color: #5b9bd4; }
    .ze-list-item.ze-multi-selected { background: rgba(91,155,212,0.08); border-left: 2px solid #5b9bd4; padding-left: 6px; }
    .ze-item-idx { font-family: 'DM Mono', monospace; font-size: 10px; color: var(--text-muted); flex-shrink: 0; min-width: 22px; padding-top: 1px; }
    .ze-item-body { flex: 1; min-width: 0; }
    .ze-item-type { font-family: 'DM Mono', monospace; font-size: 9px; color: var(--text-muted); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 2px; }
    .ze-item-text { font-family: 'Instrument Serif', serif; font-style: italic; font-size: 11.5px; color: var(--text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .ze-item-no-text { font-family: 'DM Mono', monospace; font-size: 10px; color: var(--text-muted); }
    .ze-item-del { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; padding: 0; opacity: 0; transition: all 0.1s; flex-shrink: 0; }
    .ze-list-item:hover .ze-item-del { opacity: 1; }
    .ze-item-del:hover { color: #c45c4a; }

    /* Line zones (notes view) */
    .line-zone {
      position: absolute; cursor: crosshair; border-radius: 3px;
      transition: background 0.08s, outline 0.08s; pointer-events: all;
      margin-top: -2px; /* small vertical expansion for easier clicking */
    }
    .line-zone:hover { background: rgba(200,169,110,0.18) !important; outline: 1px solid rgba(200,169,110,0.4); }
    .line-zone.has-note { background: rgba(200,169,110,0.07); cursor: pointer; }
    .zone-label {
      position: absolute; top: 1px; left: 3px; font-family: 'DM Mono', monospace;
      font-size: 8px; color: rgba(200,169,110,0.65); pointer-events: none; line-height: 1;
      white-space: nowrap; overflow: hidden; max-width: 90%; text-overflow: ellipsis;
    }
    .line-zone.ln-zone-focused {
  background: rgba(200, 169, 110, 0.18);
  outline: 2px solid rgba(200, 169, 110, 0.7);
  outline-offset: -1px;
}
    .note-underline { position: absolute; bottom: 0; left: 0; right: 0; height: 2.5px; border-radius: 1px; opacity: 0.75; }
    .note-tag {
      position: absolute; right: -38px; top: 50%; transform: translateY(-50%);
      font-family: 'DM Mono', monospace; font-size: 9px; font-weight: 500;
      padding: 2px 5px; border-radius: 2px; color: white; white-space: nowrap; opacity: 0.9; pointer-events: none;
    }

    /* ===== P1: UNIFIED COMPONENT PATTERNS ===== */
    .btn-primary { background:var(--gold); color:var(--bg-deep); border:none; font-size:13px; font-weight:600; padding:8px 20px; border-radius:6px; cursor:pointer; transition:background 0.2s; }
    .btn-primary:hover { background:var(--gold-light); }
    .btn-primary:disabled { opacity:0.6; cursor:not-allowed; }
    .btn-secondary { background:transparent; border:1px solid var(--bg-border); color:var(--text-secondary); font-size:13px; font-weight:500; padding:8px 20px; border-radius:6px; cursor:pointer; transition:all 0.2s; }
    .btn-secondary:hover { border-color:var(--gold); color:var(--gold); }
    .btn-destructive { background:transparent; border:1px solid var(--red); color:var(--red); font-size:13px; font-weight:500; padding:8px 20px; border-radius:6px; cursor:pointer; transition:all 0.2s; }
    .btn-destructive:hover { background:var(--red); color:white; }
    .btn-inline { background:none; border:none; color:var(--text-muted); font-size:13px; padding:4px 8px; cursor:pointer; transition:color 0.2s; }
    .btn-inline:hover { color:var(--gold); }
    .btn-loading { position:relative; pointer-events:none; }
    .btn-loading::after { content:''; position:absolute; right:8px; top:50%; transform:translateY(-50%); width:14px; height:14px; border:2px solid transparent; border-top-color:currentColor; border-radius:50%; animation:btnSpin 0.6s linear infinite; }
    @keyframes btnSpin { to { transform:translateY(-50%) rotate(360deg); } }

    /* ===== P1: UNIFIED MODAL ===== */
    .cue-modal-backdrop { position:fixed; inset:0; z-index:3000; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; opacity:0; transition:opacity 150ms ease; }
    .cue-modal-backdrop.cue-modal--visible { opacity:1; }
    .cue-modal-backdrop.cue-modal--closing { opacity:0; }
    .cue-modal-card { background:var(--bg-card); border:1px solid var(--bg-border); border-radius:12px; padding:24px; width:90vw; box-shadow:0 24px 80px rgba(0,0,0,0.5); transform:scale(0.95); transition:transform 150ms ease; }
    .cue-modal--visible .cue-modal-card { transform:scale(1); }
    .cue-modal-title { font-size:18px; font-weight:600; color:var(--text-primary); margin-bottom:16px; }
    .cue-modal-body { color:var(--text-secondary); font-size:14px; line-height:1.5; }
    .cue-modal-buttons { display:flex; justify-content:flex-end; gap:10px; margin-top:20px; }

    /* ===== P0: HEARTBEAT INDICATOR ===== */
    .heartbeat-dot { display:none; width:8px; height:8px; border-radius:50%; background:var(--gold); margin-left:8px; vertical-align:middle; }
    .heartbeat--healthy { animation:heartbeatPulse 2s ease-in-out infinite; }
    .heartbeat--stale { background:var(--text-muted); animation:none; }
    @keyframes heartbeatPulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

    /* ===== P3: LOGIN FORGOT PASSWORD ===== */
    .login-forgot-link { display:inline-block; margin-top:4px; margin-bottom:8px; font-size:12px; color:var(--text-muted); cursor:pointer; transition:color 0.2s; text-align:right; width:100%; }
    .login-forgot-link:hover { color:var(--gold); }

    /* ===== P3: EMPTY STATE ===== */
    .empty-state { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; padding:60px 24px; text-align:center; }
    .empty-state-icon { font-size:48px; opacity:0.5; }
    .empty-state-headline { font-size:18px; color:var(--text-primary); font-weight:500; }
    .empty-state-subtext { font-size:14px; color:var(--text-muted); max-width:360px; line-height:1.5; }

    /* ===== P3: DANGER ZONE ===== */
    .danger-zone { border:1px solid var(--red); border-radius:10px; padding:20px; margin-top:24px; }
    .danger-zone-header { display:flex; align-items:center; justify-content:space-between; cursor:pointer; color:var(--red); font-size:13px; font-weight:600; text-transform:uppercase; letter-spacing:1px; }
    .danger-zone-content { display:none; margin-top:16px; }
    .danger-zone.open .danger-zone-content { display:block; }

    /* ===== P3: MOBILE RESPONSIVENESS ===== */
    @media (max-width:1024px) {
      .rs-sidebar { position:fixed; left:-280px; top:0; bottom:0; z-index:500; transition:left 0.3s ease; box-shadow:4px 0 24px rgba(0,0,0,0.4); }
      .rs-sidebar.drawer-open { left:0; }
      .diagram-panel { display:none; }
    }
    @media (max-width:768px) {
      .rs-controls { position:fixed; bottom:0; left:0; right:0; height:auto; max-height:40vh; z-index:400; border-top:1px solid var(--bg-border); }
      .rs-sidebar { display:none; }
    }
</style>
</head>
<body>
  <!-- Toast container -->
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

  <!-- Login overlay -->
  <div id="login-overlay">
    <div class="login-card">
      <h1>CUE</h1>
      <p class="subtitle">Stage Management Platform</p>
      <input type="email" id="login-email" placeholder="Email" autocomplete="email" />
      <input type="password" id="login-password" placeholder="Password" autocomplete="current-password" />
      <a class="login-forgot-link" id="login-forgot-password" href="#">Forgot password?</a>
      <button class="login-btn" id="login-btn">Sign In</button>
      <p class="login-error" id="login-error"></p>
    </div>
  </div>

  <!-- Dashboard view -->
  <div id="dashboard-view">
    <div class="dash-header">
      <span class="logo">CUE</span>
      <div class="dash-header-right">
        <span class="user-email" id="dash-user-email"></span>
        <button class="dash-logout-btn" id="dash-logout-btn">Sign Out</button>
      </div>
    </div>
    <div class="dash-body">
      <h2 class="dash-section-title">Your Productions</h2>
      <div class="dash-actions">
        <button class="dash-action-btn" id="create-production-btn">+ Create Production</button>
        <button class="dash-action-btn" id="join-production-btn">Join with Code</button>
      </div>
      <div class="productions-grid" id="productions-grid"></div>
    </div>
  </div>

  <!-- Main app view -->
  <div id="app-view">
    <!-- Top Bar -->
    <div class="app-topbar">
      <span class="app-topbar-logo" id="app-back-logo">CUE</span>
      <span class="app-topbar-title" id="app-prod-title"></span>
      <span class="role-badge app-topbar-badge" id="app-role-badge"></span>
      <div class="app-topbar-spacer" style="flex:1"></div>
      <button class="topbar-btn" id="app-logout-btn">Sign Out</button>
    </div>
    <!-- Tab Bar -->
    <div class="app-tabbar">
      <button class="app-tab app-tab--active" data-tab="runshow">Run Show</button>
      <button class="app-tab" data-tab="props">Props</button>
      <button class="app-tab" data-tab="linenotes">Edit Script</button>
      <button class="app-tab" data-tab="cast">Cast &amp; Crew</button>
      <button class="app-tab" data-tab="settings">Settings</button>
    </div>
    <!-- TAB CONTENT AREA -->
    <div class="app-tab-content">
      <!-- RUN SHOW TAB (default, first tab) -->
      <div class="tab-panel tab-panel--active" id="tab-runshow">
        <div class="rs-layout">
          <!-- LEFT: Cast list, note type, note log -->
          <div class="rs-sidebar" id="rs-sidebar">
            <div class="rs-sidebar-header">
              <span class="ln-logo">CUE</span>
              <span class="show-name" id="rs-show-name"></span>
                <span class="heartbeat-dot" id="rs-heartbeat-dot" title="Session syncing"></span>
              <div style="margin-left:auto;display:flex;gap:6px;">
                <button class="ln-header-btn" id="rs-email-notes-btn">Email Notes</button>
                <button class="ln-header-btn" id="rs-send-btn">Send Notes</button>
              </div>
            </div>
            <div class="ln-sidebar-section">
              <h5>Cast</h5>
              <div id="rs-cast-list"></div>
            </div>
            <div class="ln-sidebar-section">
              <h5>Note Type</h5>
              <div class="note-types" id="rs-note-types"></div>
            </div>
            <div class="ln-sidebar-section" style="flex:1;display:flex;flex-direction:column;overflow:hidden;">
              <h5>Notes</h5>
              <div class="notes-list" id="rs-notes-list"></div>
            </div>
          </div>

          <!-- Diagram panel (Feature 4) -->
          <div class="diagram-panel collapsed" id="rs-diagram-panel">
            <button class="diagram-toggle-btn" id="rs-diagram-toggle">»</button>
            <div class="rs-diagram-zoom-controls" id="rs-diagram-zoom-controls" style="display:none;">
              <button class="rs-diagram-zoom-btn" id="rs-diagram-zoom-out" title="Zoom out">−</button>
              <span class="rs-diagram-zoom-level" id="rs-diagram-zoom-level">100%</span>
              <button class="rs-diagram-zoom-btn" id="rs-diagram-zoom-in" title="Zoom in">+</button>
              <button class="rs-diagram-zoom-btn" id="rs-diagram-zoom-fit" title="Fit to panel" style="font-size:11px;">⊞</button>
            </div>
            <div class="rs-diagram-viewer" id="rs-diagram-viewer">
              <div class="rs-diagram-viewer-inner" id="rs-diagram-images"></div>
            </div>
          </div>

          <!-- CENTER: Script PDF, hit overlay, popover, FAB -->
          <div class="rs-script-area" id="rs-script-area">
            <!-- Panel collapse toggles -->
            <button class="rs-collapse-btn rs-collapse-btn--left" id="rs-collapse-left" title="Toggle left panel">‹</button>
            <button class="rs-collapse-btn rs-collapse-btn--right" id="rs-collapse-right" title="Toggle right panel">›</button>
            <!-- Page nav header -->
            <div class="ln-header" style="flex-shrink:0;">
              <div class="ln-page-nav" id="rs-page-nav" style="display:none;">
                <button id="rs-prev-page">&#x2039;</button>
                <input id="rs-page-input" type="text" value="1" style="width:44px;background:var(--bg-raised);border:1px solid var(--bg-border);color:var(--text-primary);font-family:'DM Mono',monospace;font-size:12px;padding:3px 6px;border-radius:3px;text-align:center;">
                <span style="color:var(--text-muted)">/ <span id="rs-total-pages">1</span></span>
                <button id="rs-next-page">&#x203a;</button>
              </div>
              <span id="rs-script-offset-badge" style="display:none;font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);border:1px solid #c8a96e44;border-radius:3px;padding:2px 6px;margin-left:2px;" title="Script page offset active"></span>
              <button class="ln-header-btn" id="rs-split-btn">2-up</button>
            </div>

          <!-- Cue banner (Feature 5) -->
            <div id="rs-cue-banner" class="rs-cue-banner"></div>

          <!-- Script drop zone / upload (shown only for owners with no script) -->
            <div id="rs-drop-zone" style="display:none;flex:1;flex-direction:column;align-items:center;justify-content:center;gap:20px;width:100%;min-height:0;padding:24px;">
              <div style="border:1.5px dashed #3d3a36;border-radius:12px;padding:60px 80px;text-align:center;">
                <div style="font-size:48px;margin-bottom:16px;opacity:0.4;">&#x1F4C4;</div>
                <div style="font-family:'Instrument Serif',serif;font-size:28px;color:var(--text-primary);margin-bottom:8px;">Drop your script here</div>
                <div style="font-size:13px;color:var(--text-muted);line-height:1.6;margin-bottom:20px;">Text-based PDF &middot; Click to browse</div>
                <button class="ln-header-btn" id="rs-upload-btn" style="padding:8px 20px;">Choose PDF</button>
                <input type="file" id="rs-file-input" accept=".pdf" style="display:none;">
              </div>
            </div>

            <!-- Script canvas area (flex:1, always present, shows page wrapper when loaded) -->
            <div id="rs-canvas-area" style="flex:1;overflow:auto;display:flex;align-items:flex-start;justify-content:center;padding:20px;background:var(--bg-deep);position:relative;min-height:0;">
              <div id="rs-page-wrapper" style="position:relative;box-shadow:0 8px 48px rgba(0,0,0,0.6);display:none;flex-shrink:0;">
                <canvas id="rs-canvas" style="display:block;background:#faf8f3;"></canvas>
                <div id="rs-hit-overlay" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10;"></div>
                <div id="rs-draw-overlay" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:20;">
                  <div id="rs-rubber-band" style="position:absolute;border:1.5px dashed #c8a96e;background:rgba(200,169,110,0.08);border-radius:2px;display:none;"></div>
                </div>
              </div>
              <div id="rs-processing" class="processing-overlay">
                <span class="text">Loading script&#x2026;</span>
                <div class="processing-bar"><div class="processing-bar-fill" id="rs-progress-fill"></div></div>
              </div>
            </div>

            <!-- Quick-entry FAB (active run only) -->
            <button id="run-show-fab" class="run-show-fab hidden">&#x266a; Log Note</button>
          </div>

          <!-- RIGHT: Timer / session controls, stage columns, scratchpad -->
          <div class="rs-controls" id="rs-controls">
            <!-- Rendered dynamically by runshow.js -->
          </div>
        </div>
      </div>

      <!-- Quick-entry popover (active run only) -->
      <div id="run-note-popover" class="run-note-popover" style="display:none;">
        <div class="run-note-popover-inner">
          <div class="rnp-page-label" id="rnp-page-label">Page 1</div>
          <div id="rnp-chars" class="popover-chars"></div>
          <div id="rnp-types" class="popover-types"></div>
          <div id="rnp-line-preview" style="display:none;margin:6px 8px 0;padding:6px 10px;width:calc(100% - 16px);background:var(--bg-raised);border:1px solid var(--bg-border);border-radius:4px;font-size:11px;color:var(--text-secondary);font-style:italic;max-height:48px;overflow-y:auto;box-sizing:border-box;line-height:1.4;"></div>
          <input type="text" id="rnp-text" class="form-input" placeholder="Add a note…" maxlength="500" style="margin:6px 8px 0;width:calc(100% - 16px);" />
          <div class="modal-btns" style="padding:8px;">
            <button class="modal-btn-cancel" id="rnp-cancel">Cancel</button>
            <button class="modal-btn-primary" id="rnp-confirm">Add Note</button>
          </div>
        </div>
      </div>

      <!-- Run Show note popover (zone-click) -->
      <div id="rs-note-popover" class="note-popover">
        <div id="rs-pop-line-text" class="popover-line-text"></div>
        <div class="popover-section-label" id="rs-pop-cast-label">Cast</div>
        <div id="rs-pop-chars" class="popover-chars"></div>
        <div id="rs-pop-types" class="popover-types"></div>
        <textarea id="rs-pop-note-text" class="form-input" placeholder="Optional note…" maxlength="500" rows="2" style="margin:6px 8px 0;width:calc(100% - 16px);min-height:40px;resize:vertical;font-size:12px;"></textarea>
        <div class="popover-btns">
          <button class="popover-btn popover-btn--cancel" id="rs-pop-cancel-btn">Cancel</button>
          <button class="popover-btn popover-btn--confirm" id="rs-pop-confirm-btn">Add Note &#x21b5;</button>
        </div>
      </div>

      <!-- Run report modal -->
      <div id="run-report-modal" class="modal-backdrop run-report-modal" style="display:none;">
        <div class="run-report-card">
          <div class="run-report-header">
            <h2 id="run-report-title">Run Report</h2>
            <div class="run-report-actions">
              <button class="settings-btn settings-btn--primary" id="run-report-print">Print / Save PDF &#x2197;</button>
              <button class="settings-btn" id="run-report-email">Send Email</button>
              <button class="modal-btn-cancel" id="run-report-close">Close</button>
            </div>
          </div>
          <div id="run-report-body" class="run-report-body"></div>
        </div>
      </div>

      <!-- Send notes modal for Run Show -->
      <div class="send-notes-modal" id="rs-send-notes-modal"></div>

      <!-- Email notes modal (Feature 7) -->
      <div class="send-notes-modal" id="rs-email-notes-modal"></div>

      <!-- PROPS TAB -->
      <div class="tab-panel" id="tab-props">
        <div class="props-subtabs" id="props-subtabs">
          <button class="props-subtab props-subtab--active" data-subtab="manage">Manage Props</button>
          <button class="props-subtab" data-subtab="view">View Show</button>
          <button class="props-subtab" data-subtab="check">Pre/Post Check</button>
        </div>
        <div class="props-content" id="props-content"></div>
      </div>
      <!-- EDIT SCRIPT TAB (renamed from Line Notes — Features 4+5) -->
      <div class="tab-panel" id="tab-linenotes">
        <div class="ln-subtabs" id="ln-subtabs">
          <button class="ln-subtab ln-subtab--active" data-lntab="zones">Line Notes</button>
          <button class="ln-subtab" data-lntab="cues">Cues &amp; Diagrams</button>
        </div>
    <div class="ln-header">
      <span class="ln-logo">CUE</span>
      <span class="show-name" id="ln-show-name"></span>
      <div class="ln-spacer"></div>
      <div class="ln-page-nav" id="ln-page-nav" style="display:none">
        <button id="ln-prev-page">‹</button>
        <input id="ln-page-input" type="text" value="1" style="width:52px;background:var(--bg-raised);border:1px solid var(--bg-border);color:var(--text-primary);font-family:'DM Mono',monospace;font-size:12px;padding:3px 6px;border-radius:3px;text-align:center;">
        <span style="color:var(--text-muted)">/ <span id="ln-total-pages">1</span></span>
        <button id="ln-next-page">›</button>
        <span id="ln-page-hint" style="font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);display:none;"></span>
      </div>
      <span id="ln-page-start-badge" style="display:none;font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);border:1px solid #c8a96e44;border-radius:3px;padding:2px 6px;"></span>
      <button class="ln-header-btn" id="ln-set-page1-btn" title="Mark the current PDF page as script page 1 (sets the page number offset)">Set p.1 here</button>
      <button class="ln-header-btn" id="ln-split-btn">2-up</button>
      <button class="ln-header-btn ln-header-btn--active" id="ln-view-zones-btn">Zones</button>
    </div>

    <div class="ln-body">
      <!-- Cues & Diagrams panel (Feature 5) -->
      <div id="ln-cues-panel" style="flex:1;overflow-y:auto;padding:24px;display:none;"></div>

      <!-- ZONE EDITOR AREA (the only view in Line Notes now) -->
      <div id="ln-zone-editor-area" style="flex:1;overflow:hidden;display:flex;flex-direction:row;">
        <div id="ze-canvas-panel" style="flex:1;overflow:auto;background:#2a2825;display:flex;flex-direction:column;align-items:center;padding:24px 24px 48px;">
          <div id="ze-page-wrapper" style="position:relative;box-shadow:0 8px 48px rgba(0,0,0,0.6);flex-shrink:0;cursor:crosshair;">
            <canvas id="ze-canvas" style="display:block;background:#faf8f3;"></canvas>
            <div id="ze-edit-overlay" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:all;">
              <div id="ze-rubber-band" style="position:absolute;border:1.5px dashed #e8c98e;background:rgba(232,201,142,0.1);border-radius:2px;pointer-events:none;display:none;z-index:30;"></div>
            </div>
          </div>
        </div>

        <div id="ze-list-panel" style="width:300px;background:var(--bg-card);border-left:1px solid var(--bg-border);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;">
          <div style="padding:14px 16px 10px;border-bottom:1px solid var(--bg-border);flex-shrink:0;">
            <div style="font-family:'Instrument Serif',serif;font-size:16px;color:var(--text-primary);margin-bottom:6px;">Line Zones</div>
            <div id="ze-list-meta" style="font-family:'DM Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:10px;">0 zones on this page</div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;">
              <button class="ze-tool-btn" id="ze-btn-reextract">↺ Re-extract</button>
              <button class="ze-tool-btn" id="ze-btn-draw">+ Draw</button>
              <button class="ze-tool-btn ze-danger" id="ze-btn-clear">✕ Clear</button>
              <button class="ze-tool-btn ze-accent" id="ze-btn-save">✓ Save</button>
            </div>
          </div>
          <div id="ze-multi-bar" style="align-items:center;gap:6px;padding:8px 16px;background:var(--bg-raised);border-bottom:1px solid var(--bg-border);flex-shrink:0;">
            <span id="ze-multi-count" style="font-family:'DM Mono',monospace;font-size:11px;color:#5b9bd4;flex:1;"></span>
            <button class="ze-tool-btn" id="ze-btn-multi-char">Char Name <kbd>C</kbd></button>
            <button class="ze-tool-btn" id="ze-btn-multi-dir">Stage Dir <kbd>S</kbd></button>
            <button class="ze-tool-btn ze-danger" id="ze-btn-multi-del">Delete All</button>
            <button class="ze-tool-btn" id="ze-btn-multi-clear">✕</button>
          </div>
          <div id="ze-items-list" style="flex:1;min-height:0;overflow-y:auto;padding:6px 8px;"></div>
          <div id="ze-detail" style="padding:14px 16px;">
            <div style="font-family:'DM Mono',monospace;font-size:10px;letter-spacing:0.1em;text-transform:uppercase;color:var(--text-muted);margin-bottom:10px;">Edit Zone</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px;">
              <div><div class="ze-label">X %</div><input class="ze-input" id="zd-x" type="number" step="0.1"></div>
              <div><div class="ze-label">Y %</div><input class="ze-input" id="zd-y" type="number" step="0.1"></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px;">
              <div><div class="ze-label">W %</div><input class="ze-input" id="zd-w" type="number" step="0.1"></div>
              <div><div class="ze-label">H %</div><input class="ze-input" id="zd-h" type="number" step="0.1"></div>
            </div>
            <div style="margin-bottom:10px;">
              <div class="ze-label">Text <span style="color:#3d3a36;font-size:8px;letter-spacing:0;text-transform:none;font-family:'Inter',sans-serif;">— updates live</span></div>
              <textarea class="ze-input" id="zd-text" rows="3" style="font-family:'Instrument Serif',serif;font-style:italic;font-size:13px;min-height:54px;resize:vertical;line-height:1.5;border-color:var(--text-muted);" placeholder="Type the line text…"></textarea>
            </div>
            <label style="display:flex;align-items:center;gap:7px;margin-bottom:10px;cursor:pointer;">
              <input type="checkbox" id="zd-charname" style="accent-color:#5b9bd4;">
              <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--text-secondary);">Character name <kbd>C</kbd></span>
            </label>
            <label style="display:flex;align-items:center;gap:7px;margin-bottom:10px;cursor:pointer;">
              <input type="checkbox" id="zd-stagedir" style="accent-color:#5b9bd4;">
              <span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--text-secondary);">Stage direction <kbd>S</kbd></span>
            </label>
            <div style="display:flex;gap:6px;justify-content:flex-end;">
              <button class="ze-tool-btn ze-danger" id="ze-btn-del-zone">Delete Zone</button>
              <button class="ze-tool-btn ze-accent" id="ze-btn-apply">Apply</button>
            </div>
          </div>
          <div id="ze-saved-badge" style="font-family:'DM Mono',monospace;font-size:10px;color:#6a9e72;display:flex;align-items:center;gap:4px;padding:6px 16px;opacity:0;transition:opacity 0.4s;">✓ saved</div>
        </div>
      </div>
    </div>
  
      </div>
      <!-- CAST & CREW TAB -->
      <div class="tab-panel" id="tab-cast">
        <div class="cast-tab-content" id="cast-content"></div>
      </div>
      <!-- SETTINGS TAB -->
      <div class="tab-panel" id="tab-settings">
        <div class="settings-content" id="settings-content"></div>
      </div>
    </div>
  </div>

  <!-- Character modal (used by Cast tab) -->
  <div class="cast-modal" id="cast-modal"></div>
  <div class="char-modal" id="char-modal"></div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>